import { Directive, HostListener, Inject, Input } from '@angular/core';
import { zip } from "rxjs";
import * as i0 from "@angular/core";
import * as i1 from "../service/translate/translation-client.service";
import * as i2 from "../service/image-upload/image-upload.service";
export class DyImageEditDirective {
    constructor(el, clientService, imageUploadService, backendUrl) {
        this.el = el;
        this.clientService = clientService;
        this.imageUploadService = imageUploadService;
        this.backendUrl = backendUrl;
        this.editMode = false;
    }
    onKeyup() {
        if (this.editMode) {
            this.imageUploadService.openDialog().subscribe(res => {
                this.changeImage(res.urls.originalUrl, res.alt);
                this.save(res.urls, res.alt);
            });
        }
    }
    save(response, alt) {
        if (response && alt) {
            this.clientService.next('images.' + this.libDyImageEdit + '.originalUrl', response.originalUrl);
            this.clientService.next('images.' + this.libDyImageEdit + '.thumbnailUrl', response.thumbnailUrl);
            response.compressedUrls.forEach((compressedUrl, index) => {
                this.clientService.next('images.' + this.libDyImageEdit + '.compressed.' + index + '.url', compressedUrl.url);
                this.clientService.next('images.' + this.libDyImageEdit + '.compressed.' + index + '.height', compressedUrl.height);
                this.clientService.next('images.' + this.libDyImageEdit + '.compressed.' + index + '.width', compressedUrl.width);
            });
            this.clientService.next('images.' + this.libDyImageEdit + '.alt', alt);
        }
    }
    ngOnInit() {
        const originalBorder = this.el.nativeElement.style.border;
        this.clientService.editSubject.subscribe(editMode => {
            this.editMode = editMode;
            // Get the native element using ElementRef
            const element = this.el.nativeElement;
            // Check the condition and apply the dashed border if needed
            if (this.editMode) {
                element.style.border = '2px dashed #a9a9a9';
            }
            else {
                element.style.border = originalBorder;
            }
        });
        const urlKey = 'images.' + this.libDyImageEdit + '.originalUrl';
        const altKey = 'images.' + this.libDyImageEdit + '.alt';
        const key1$ = this.clientService.streamTranslation(urlKey);
        const key2$ = this.clientService.streamTranslation(altKey);
        zip([key1$, key2$]).subscribe(([url, alt]) => {
            if (urlKey != url || altKey != alt) {
                this.changeImage(url, alt);
            }
            this.el.nativeElement.contentEditable = this.editMode;
        });
    }
    changeImage(url, alt) {
        this.el.nativeElement.src = url;
        this.el.nativeElement.alt = alt;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: DyImageEditDirective, deps: [{ token: i0.ElementRef }, { token: i1.TranslationClientService }, { token: i2.ImageUploadService }, { token: 'backendUrl' }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.3.10", type: DyImageEditDirective, isStandalone: true, selector: "[libDyImageEdit]", inputs: { libDyImageEdit: "libDyImageEdit", src: "src" }, host: { listeners: { "click": "onKeyup()" } }, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: DyImageEditDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[libDyImageEdit]',
                    standalone: true
                }]
        }], ctorParameters: () => [{ type: i0.ElementRef }, { type: i1.TranslationClientService }, { type: i2.ImageUploadService }, { type: undefined, decorators: [{
                    type: Inject,
                    args: ['backendUrl']
                }] }], propDecorators: { libDyImageEdit: [{
                type: Input,
                args: [{ required: true }]
            }], src: [{
                type: Input,
                args: [{ required: true }]
            }], onKeyup: [{
                type: HostListener,
                args: ['click']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHktaW1hZ2UtZWRpdC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9jdXN0b20tZGlzcGxheS9zcmMvbGliL2RpcmVjdGl2ZXMvZHktaW1hZ2UtZWRpdC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFNBQVMsRUFBYyxZQUFZLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBUyxNQUFNLGVBQWUsQ0FBQztBQUN6RixPQUFPLEVBQUMsR0FBRyxFQUFDLE1BQU0sTUFBTSxDQUFDOzs7O0FBU3pCLE1BQU0sT0FBTyxvQkFBb0I7SUFNL0IsWUFBb0IsRUFBYyxFQUFVLGFBQXVDLEVBQVUsa0JBQXNDLEVBQWdDLFVBQWtCO1FBQWpLLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxrQkFBYSxHQUFiLGFBQWEsQ0FBMEI7UUFBVSx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBQWdDLGVBQVUsR0FBVixVQUFVLENBQVE7UUFGN0ssYUFBUSxHQUFZLEtBQUssQ0FBQztJQUdsQyxDQUFDO0lBR00sT0FBTztRQUNaLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixJQUFJLENBQUMsa0JBQWtCLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUNuRCxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtnQkFDL0MsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUM5QixDQUFDLENBQUMsQ0FBQTtTQUNIO0lBQ0gsQ0FBQztJQUVELElBQUksQ0FBQyxRQUE2QixFQUFFLEdBQVc7UUFDN0MsSUFBSSxRQUFRLElBQUksR0FBRyxFQUFFO1lBQ25CLElBQUksQ0FBQyxh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LEdBQUcsQ0FBQTtRQUMvQixJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFBO0lBRWpDLENBQUM7K0dBakVVLG9CQUFvQixzSEFNOEcsWUFBWTttR0FOOUksb0JBQW9COzs0RkFBcEIsb0JBQW9CO2tCQUpoQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxrQkFBa0I7b0JBQzVCLFVBQVUsRUFBRSxJQUFJO2lCQUNqQjs7MEJBT3VJLE1BQU07MkJBQUMsWUFBWTt5Q0FMaEksY0FBYztzQkFBdEMsS0FBSzt1QkFBQyxFQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUM7Z0JBQ0UsR0FBRztzQkFBM0IsS0FBSzt1QkFBQyxFQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUM7Z0JBUWhCLE9BQU87c0JBRGIsWUFBWTt1QkFBQyxPQUFPIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIEhvc3RMaXN0ZW5lciwgSW5qZWN0LCBJbnB1dCwgT25Jbml0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7emlwfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHtUcmFuc2xhdGlvbkNsaWVudFNlcnZpY2V9IGZyb20gXCIuLi9zZXJ2aWNlL3RyYW5zbGF0ZS90cmFuc2xhdGlvbi1jbGllbnQuc2VydmljZVwiO1xuaW1wb3J0IHtJbWFnZVVwbG9hZFNlcnZpY2V9IGZyb20gXCIuLi9zZXJ2aWNlL2ltYWdlLXVwbG9hZC9pbWFnZS11cGxvYWQuc2VydmljZVwiO1xuaW1wb3J0IHtVcGxvYWRJbWFnZVJlc3BvbnNlfSBmcm9tIFwiLi4vbW9kZWwvaW1hZ2VzL3VwbG9hZC1pbWFnZS1yZXNwb25zZVwiO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbGliRHlJbWFnZUVkaXRdJyxcbiAgc3RhbmRhbG9uZTogdHJ1ZVxufSlcbmV4cG9ydCBjbGFzcyBEeUltYWdlRWRpdERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCh7cmVxdWlyZWQ6IHRydWV9KSBsaWJEeUltYWdlRWRpdCE6IHN0cmluZztcbiAgQElucHV0KHtyZXF1aXJlZDogdHJ1ZX0pIHNyYyE6IHN0cmluZztcblxuICBwcml2YXRlIGVkaXRNb2RlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBjbGllbnRTZXJ2aWNlOiBUcmFuc2xhdGlvbkNsaWVudFNlcnZpY2UsIHByaXZhdGUgaW1hZ2VVcGxvYWRTZXJ2aWNlOiBJbWFnZVVwbG9hZFNlcnZpY2UsIEBJbmplY3QoJ2JhY2tlbmRVcmwnKSBwcml2YXRlIGJhY2tlbmRVcmw6IHN0cmluZykge1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignY2xpY2snKVxuICBwdWJsaWMgb25LZXl1cCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5lZGl0TW9kZSkge1xuICAgICAgdGhpcy5pbWFnZVVwbG9hZFNlcnZpY2Uub3BlbkRpYWxvZygpLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICB0aGlzLmNoYW5nZUltYWdlKHJlcy51cmxzLm9yaWdpbmFsVXJsLCByZXMuYWx0KVxuICAgICAgICB0aGlzLnNhdmUocmVzLnVybHMsIHJlcy5hbHQpXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIHNhdmUocmVzcG9uc2U6IFVwbG9hZEltYWdlUmVzcG9uc2UsIGFsdDogc3RyaW5nKSB7XG4gICAgaWYgKHJlc3BvbnNlICYmIGFsdCkge1xuICAgICAgdGhpcy5jbGllbnRTZXJ2aWNlLm5leHQoJ2ltYWdlcy4nICsgdGhpcy5saWJEeUltYWdlRWRpdCArICcub3JpZ2luYWxVcmwnLCByZXNwb25zZS5vcmlnaW5hbFVybClcbiAgICAgIHRoaXMuY2xpZW50U2VydmljZS5uZXh0KCdpbWFnZXMuJyArIHRoaXMubGliRHlJbWFnZUVkaXQgKyAnLnRodW1ibmFpbFVybCcsIHJlc3BvbnNlLnRodW1ibmFpbFVybClcbiAgICAgIHJlc3BvbnNlLmNvbXByZXNzZWRVcmxzLmZvckVhY2goKGNvbXByZXNzZWRVcmwsIGluZGV4KSA9PiB7XG4gICAgICAgIHRoaXMuY2xpZW50U2VydmljZS5uZXh0KCdpbWFnZXMuJyArIHRoaXMubGliRHlJbWFnZUVkaXQgKyAnLmNvbXByZXNzZWQuJyArIGluZGV4ICsgJy51cmwnLCBjb21wcmVzc2VkVXJsLnVybClcbiAgICAgICAgdGhpcy5jbGllbnRTZXJ2aWNlLm5leHQoJ2ltYWdlcy4nICsgdGhpcy5saWJEeUltYWdlRWRpdCArICcuY29tcHJlc3NlZC4nICsgaW5kZXggKyAnLmhlaWdodCcsIGNvbXByZXNzZWRVcmwuaGVpZ2h0KVxuICAgICAgICB0aGlzLmNsaWVudFNlcnZpY2UubmV4dCgnaW1hZ2VzLicgKyB0aGlzLmxpYkR5SW1hZ2VFZGl0ICsgJy5jb21wcmVzc2VkLicgKyBpbmRleCArICcud2lkdGgnLCBjb21wcmVzc2VkVXJsLndpZHRoKVxuICAgICAgfSlcbiAgICAgIHRoaXMuY2xpZW50U2VydmljZS5uZXh0KCdpbWFnZXMuJyArIHRoaXMubGliRHlJbWFnZUVkaXQgKyAnLmFsdCcsIGFsdClcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBjb25zdCBvcmlnaW5hbEJvcmRlciA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5zdHlsZS5ib3JkZXI7XG4gICAgdGhpcy5jbGllbnRTZXJ2aWNlLmVkaXRTdWJqZWN0LnN1YnNjcmliZShlZGl0TW9kZSA9PiB7XG4gICAgICB0aGlzLmVkaXRNb2RlID0gZWRpdE1vZGU7XG5cbiAgICAgIC8vIEdldCB0aGUgbmF0aXZlIGVsZW1lbnQgdXNpbmcgRWxlbWVudFJlZlxuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcbiAgICAgIC8vIENoZWNrIHRoZSBjb25kaXRpb24gYW5kIGFwcGx5IHRoZSBkYXNoZWQgYm9yZGVyIGlmIG5lZWRlZFxuICAgICAgaWYgKHRoaXMuZWRpdE1vZGUpIHtcbiAgICAgICAgZWxlbWVudC5zdHlsZS5ib3JkZXIgPSAnMnB4IGRhc2hlZCAjYTlhOWE5JztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUuYm9yZGVyID0gb3JpZ2luYWxCb3JkZXI7XG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IHVybEtleSA9ICdpbWFnZXMuJyArIHRoaXMubGliRHlJbWFnZUVkaXQgKyAnLm9yaWdpbmFsVXJsJ1xuICAgIGNvbnN0IGFsdEtleSA9ICdpbWFnZXMuJyArIHRoaXMubGliRHlJbWFnZUVkaXQgKyAnLmFsdCdcblxuICAgIGNvbnN0IGtleTEkID0gdGhpcy5jbGllbnRTZXJ2aWNlLnN0cmVhbVRyYW5zbGF0aW9uKHVybEtleSk7XG4gICAgY29uc3Qga2V5MiQgPSB0aGlzLmNsaWVudFNlcnZpY2Uuc3RyZWFtVHJhbnNsYXRpb24oYWx0S2V5KTtcblxuICAgIHppcChba2V5MSQsIGtleTIkXSkuc3Vic2NyaWJlKChbdXJsLCBhbHRdKSA9PiB7XG4gICAgICBpZiAodXJsS2V5ICE9IHVybCB8fCBhbHRLZXkgIT0gYWx0KSB7XG4gICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodXJsLCBhbHQpXG4gICAgICB9XG4gICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY29udGVudEVkaXRhYmxlID0gdGhpcy5lZGl0TW9kZTtcbiAgICB9KVxuICB9XG5cbiAgY2hhbmdlSW1hZ2UodXJsOiBzdHJpbmcsIGFsdDogc3RyaW5nKSB7XG4gICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnNyYyA9IHVybFxuICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5hbHQgPSBhbHRcblxuICB9XG5cbn1cbiJdfQ==