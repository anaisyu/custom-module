import { Directive, HostListener, Input } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "../service/translate/translation-client.service";
import * as i2 from "../service/dy-text-editor/dy-text-editor.service";
export class DyTranslateDirective {
    constructor(el, renderer, clientService, dyTextEditorService) {
        this.el = el;
        this.renderer = renderer;
        this.clientService = clientService;
        this.dyTextEditorService = dyTextEditorService;
        this.editMode = false;
        this.previousValue = '';
    }
    ngOnInit() {
        const originalBorder = this.el.nativeElement.style.outline;
        this.renderer.listen(this.el.nativeElement, 'paste', (event) => {
            if (this.editMode) {
                event.preventDefault();
                const text = (event.clipboardData).getData('text');
                this.renderer.setProperty(this.el.nativeElement, 'innerText', this.el.nativeElement.innerText + text);
            }
        });
        this.clientService.editSubject.subscribe(editMode => {
            this.editMode = editMode;
            this.el.nativeElement.contentEditable = this.editMode;
            // Get the native element using ElementRef
            const element = this.el.nativeElement;
            // Check the condition and apply the dashed border if needed
            if (this.editMode) {
                element.style.outline = '1px dashed #a9a9a9';
            }
            else {
                element.style.outline = originalBorder;
            }
        });
    }
    addNewEditorData(value) {
        if (this.appDyTranslate.includes('editor')) {
            this.dyTextEditorService.addNewEditorData(this.appDyTranslate, value);
        }
    }
    onKeyup(event) {
        const value = this.el.nativeElement.innerHTML;
        if (value != this.previousValue) {
            this.previousValue = value;
            this.addNewEditorData(value);
            this.save(value);
        }
    }
    onClick() {
        if (this.editMode && this.appDyTranslate.includes('editor')) {
            this.dyTextEditorService.displayEditorSubject.next(true);
            setTimeout(() => {
                this.addNewEditorData(this.el.nativeElement.innerHTML);
            }, 50); // why this timeout?
        }
        else {
            this.dyTextEditorService.displayEditorSubject.next(false);
        }
    }
    save(value) {
        if (value) {
            this.clientService.next(this.appDyTranslate, value);
        }
    }
    ngAfterViewInit() {
        this.clientService.streamTranslation(this.appDyTranslate).subscribe(value => {
            if (value == this.appDyTranslate && this.el.nativeElement.innerHTML) {
                this.clientService.next(this.appDyTranslate, this.el.nativeElement.innerHTML);
            }
            else {
                this.el.nativeElement.innerHTML = value;
            }
            this.el.nativeElement.contentEditable = this.editMode;
        });
        if (this.appDyTranslate.includes('editor')) {
            this.dyTextEditorService.editorDataChange.subscribe((newValue) => {
                if (newValue.key == this.appDyTranslate) {
                    if (newValue.value != this.previousValue) {
                        this.previousValue = newValue.value;
                        this.el.nativeElement.innerHTML = newValue.value;
                        this.save(newValue.value);
                    }
                }
            });
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: DyTranslateDirective, deps: [{ token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i1.TranslationClientService }, { token: i2.DyTextEditorService }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.3.10", type: DyTranslateDirective, isStandalone: true, selector: "[appDyTranslate]", inputs: { appDyTranslate: "appDyTranslate" }, host: { listeners: { "keyup": "onKeyup($event)", "click": "onClick()" } }, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: DyTranslateDirective, decorators: [{
            type: Directive,
            args: [{
                    standalone: true,
                    selector: '[appDyTranslate]'
                }]
        }], ctorParameters: () => [{ type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i1.TranslationClientService }, { type: i2.DyTextEditorService }], propDecorators: { appDyTranslate: [{
                type: Input,
                args: [{ required: true }]
            }], onKeyup: [{
                type: HostListener,
                args: ['keyup', ['$event']]
            }], onClick: [{
                type: HostListener,
                args: ['click']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHktdHJhbnNsYXRlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2N1c3RvbS1kaXNwbGF5L3NyYy9saWIvZGlyZWN0aXZlcy9keS10cmFuc2xhdGUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBZ0IsU0FBUyxFQUFjLFlBQVksRUFBRSxLQUFLLEVBQW9CLE1BQU0sZUFBZSxDQUFDOzs7O0FBUTNHLE1BQU0sT0FBTyxvQkFBb0I7SUFNL0IsWUFBb0IsRUFBYyxFQUFVLFFBQW1CLEVBQVUsYUFBdUMsRUFBVSxtQkFBd0M7UUFBOUksT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxrQkFBYSxHQUFiLGFBQWEsQ0FBMEI7UUFBVSx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO1FBSjFKLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFDMUIsa0JBQWEsR0FBVyxFQUFFLENBQUM7SUFJbkMsQ0FBQztJQUVELFFBQVE7UUFDTixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBRTNELElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLE9BQU8sRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQzdELElBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDaEIsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUN2QixNQUFNLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ25ELElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLFdBQVcsRUFBRSxJQUFJLENBQUMs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QyxhQUFhLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDeEQsQ0FBQyxDQUFDLENBQUE7UUFFRixJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQzFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtnQkFDL0QsSUFBSSxRQUFRLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7b0JBQ3ZDLElBQUksUUFBUSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO3dCQUN4QyxJQUFJLENBQUMsYUFBYSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUE7d0JBQ25DLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFBO3dCQUNoRCxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtxQkFDMUI7aUJBQ0Y7WUFDSCxDQUFDLENBQUMsQ0FBQTtTQUNIO0lBQ0gsQ0FBQzsrR0EzRlUsb0JBQW9CO21HQUFwQixvQkFBb0I7OzRGQUFwQixvQkFBb0I7a0JBSmhDLFNBQVM7bUJBQUM7b0JBQ1QsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLFFBQVEsRUFBRSxrQkFBa0I7aUJBQzdCO2dMQUUwQixjQUFjO3NCQUF0QyxLQUFLO3VCQUFDLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQztnQkEyQ2hCLE9BQU87c0JBRGIsWUFBWTt1QkFBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0JBVVYsT0FBTztzQkFBN0IsWUFBWTt1QkFBQyxPQUFPIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBZnRlclZpZXdJbml0LCBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIEhvc3RMaXN0ZW5lciwgSW5wdXQsIE9uSW5pdCwgUmVuZGVyZXIyfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7VHJhbnNsYXRpb25DbGllbnRTZXJ2aWNlfSBmcm9tIFwiLi4vc2VydmljZS90cmFuc2xhdGUvdHJhbnNsYXRpb24tY2xpZW50LnNlcnZpY2VcIjtcbmltcG9ydCB7RHlUZXh0RWRpdG9yU2VydmljZX0gZnJvbSBcIi4uL3NlcnZpY2UvZHktdGV4dC1lZGl0b3IvZHktdGV4dC1lZGl0b3Iuc2VydmljZVwiO1xuXG5ARGlyZWN0aXZlKHtcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgc2VsZWN0b3I6ICdbYXBwRHlUcmFuc2xhdGVdJ1xufSlcbmV4cG9ydCBjbGFzcyBEeVRyYW5zbGF0ZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XG4gIEBJbnB1dCh7cmVxdWlyZWQ6IHRydWV9KSBhcHBEeVRyYW5zbGF0ZSE6IHN0cmluZztcbiAgcHJpdmF0ZSBlZGl0TW9kZTogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIHByZXZpb3VzVmFsdWU6IHN0cmluZyA9ICcnO1xuXG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBwcml2YXRlIGNsaWVudFNlcnZpY2U6IFRyYW5zbGF0aW9uQ2xpZW50U2VydmljZSwgcHJpdmF0ZSBkeVRleHRFZGl0b3JTZXJ2aWNlOiBEeVRleHRFZGl0b3JTZXJ2aWNlKSB7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBjb25zdCBvcmlnaW5hbEJvcmRlciA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5zdHlsZS5vdXRsaW5lO1xuXG4gICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAncGFzdGUnLCAoZXZlbnQpID0+IHtcbiAgICAgIGlmKHRoaXMuZWRpdE1vZGUpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgdGV4dCA9IChldmVudC5jbGlwYm9hcmREYXRhKS5nZXREYXRhKCd0ZXh0Jyk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnaW5uZXJUZXh0JywgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmlubmVyVGV4dCArIHRleHQpO1xuICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICB0aGlzLmNsaWVudFNlcnZpY2UuZWRpdFN1YmplY3Quc3Vic2NyaWJlKGVkaXRNb2RlID0+IHtcbiAgICAgIHRoaXMuZWRpdE1vZGUgPSBlZGl0TW9kZTtcbiAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jb250ZW50RWRpdGFibGUgPSB0aGlzLmVkaXRNb2RlO1xuXG4gICAgICAvLyBHZXQgdGhlIG5hdGl2ZSBlbGVtZW50IHVzaW5nIEVsZW1lbnRSZWZcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgIC8vIENoZWNrIHRoZSBjb25kaXRpb24gYW5kIGFwcGx5IHRoZSBkYXNoZWQgYm9yZGVyIGlmIG5lZWRlZFxuICAgICAgaWYgKHRoaXMuZWRpdE1vZGUpIHtcbiAgICAgICAgZWxlbWVudC5zdHlsZS5vdXRsaW5lID0gJzFweCBkYXNoZWQgI2E5YTlhOSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LnN0eWxlLm91dGxpbmUgPSBvcmlnaW5hbEJvcmRlcjtcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgYWRkTmV3RWRpdG9yRGF0YSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuYXBwRHlUcmFuc2xhdGUuaW5jbHVkZXMoJ2VkaXRvcicpKSB7XG4gICAgICB0aGlzLmR5VGV4dEVkaXRvclNlcnZpY2UuYWRkTmV3RWRpdG9yRGF0YSh0aGlzLmFwcER5VHJhbnNsYXRlLCB2YWx1ZSlcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdrZXl1cCcsIFsnJGV2ZW50J10pXG4gIHB1YmxpYyBvbktleXVwKGV2ZW50OiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCB2YWx1ZTogc3RyaW5nID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LmlubmVySFRNTFxuICAgIGlmICh2YWx1ZSAhPSB0aGlzLnByZXZpb3VzVmFsdWUpIHtcbiAgICAgIHRoaXMucHJldmlvdXNWYWx1ZSA9IHZhbHVlXG4gICAgICB0aGlzLmFkZE5ld0VkaXRvckRhdGEodmFsdWUpXG4gICAgICB0aGlzLnNhdmUodmFsdWUpXG4gICAgfVxuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignY2xpY2snKSBvbkNsaWNrKCkge1xuICAgIGlmICh0aGlzLmVkaXRNb2RlICYmIHRoaXMuYXBwRHlUcmFuc2xhdGUuaW5jbHVkZXMoJ2VkaXRvcicpKSB7XG4gICAgICB0aGlzLmR5VGV4dEVkaXRvclNlcnZpY2UuZGlzcGxheUVkaXRvclN1YmplY3QubmV4dCh0cnVlKVxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuYWRkTmV3RWRpdG9yRGF0YSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MKVxuICAgICAgfSwgNTApIC8vIHdoeSB0aGlzIHRpbWVvdXQ/XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZHlUZXh0RWRpdG9yU2VydmljZS5kaXNwbGF5RWRpdG9yU3ViamVjdC5uZXh0KGZhbHNlKVxuICAgIH1cbiAgfVxuXG4gIHNhdmUodmFsdWU6IHN0cmluZykge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5jbGllbnRTZXJ2aWNlLm5leHQodGhpcy5hcHBEeVRyYW5zbGF0ZSwgdmFsdWUpXG4gICAgfVxuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuY2xpZW50U2VydmljZS5zdHJlYW1UcmFuc2xhdGlvbih0aGlzLmFwcER5VHJhbnNsYXRlKS5zdWJzY3JpYmUodmFsdWUgPT4ge1xuICAgICAgaWYgKHZhbHVlID09IHRoaXMuYXBwRHlUcmFuc2xhdGUgJiYgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmlubmVySFRNTCkge1xuICAgICAgICB0aGlzLmNsaWVudFNlcnZpY2UubmV4dCh0aGlzLmFwcER5VHJhbnNsYXRlLCB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9IHZhbHVlO1xuICAgICAgfVxuICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNvbnRlbnRFZGl0YWJsZSA9IHRoaXMuZWRpdE1vZGU7XG4gICAgfSlcblxuICAgIGlmICh0aGlzLmFwcER5VHJhbnNsYXRlLmluY2x1ZGVzKCdlZGl0b3InKSkge1xuICAgICAgdGhpcy5keVRleHRFZGl0b3JTZXJ2aWNlLmVkaXRvckRhdGFDaGFuZ2Uuc3Vic2NyaWJlKChuZXdWYWx1ZSkgPT4ge1xuICAgICAgICBpZiAobmV3VmFsdWUua2V5ID09IHRoaXMuYXBwRHlUcmFuc2xhdGUpIHtcbiAgICAgICAgICBpZiAobmV3VmFsdWUudmFsdWUgIT0gdGhpcy5wcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnByZXZpb3VzVmFsdWUgPSBuZXdWYWx1ZS52YWx1ZVxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9IG5ld1ZhbHVlLnZhbHVlXG4gICAgICAgICAgICB0aGlzLnNhdmUobmV3VmFsdWUudmFsdWUpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG59XG4iXX0=