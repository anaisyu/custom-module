import { Injectable } from '@angular/core';
import { BehaviorSubject, combineLatest, map, Subject } from "rxjs";
import * as i0 from "@angular/core";
import * as i1 from "../translate/translation-client.service";
export class ChangeColorsService {
    constructor(clientService) {
        this.clientService = clientService;
        this.cssVariableNames = [
            '--dy-color-1-original',
            '--dy-color-2-original',
            '--dy-color-3-original',
            '--dy-color-4-original',
            '--dy-color-5-original',
            '--dy-color-6-original',
            '--dy-color-7-original',
            '--dy-primary',
            '--dy-primary-hover',
            '--dy-secondary',
            '--dy-secondary-hover',
            '--dy-text',
            '--dy-text-primary',
            '--dy-text-secondary',
        ];
        this.cssVariables = {};
        this.paletteCssVariables = {};
        this.cssVariablesSubject = new BehaviorSubject({});
        this.paletteSubject = new BehaviorSubject([]);
        this.displaySubject = new BehaviorSubject(false);
        this.ready1 = new Subject();
        this.ready2 = new Subject();
        this.ready = combineLatest([this.ready1, this.ready2]).pipe(map(([val1, val2]) => val1 && val2));
    }
    getStylesFromCssFile() {
        const rootStyles = getComputedStyle(document.documentElement);
        this.cssVariableNames.forEach(variable => {
            if (rootStyles.getPropertyValue(variable).trim()) {
                if (variable.includes('original')) {
                    this.paletteCssVariables[variable] = rootStyles.getPropertyValue(variable).trim();
                }
                else if (!this.cssVariables[variable]) {
                    this.cssVariables[variable] = rootStyles.getPropertyValue(variable).trim();
                }
            }
        });
        this.cssVariablesSubject.next(Object.assign({}, this.cssVariables));
        this.paletteSubject.next(Object.values(this.paletteCssVariables));
        this.ready1.next(true);
    }
    registerElementRef(element) {
        // used in app component
        this.element = element;
    }
    getStylesFromConfigFile(renderer) {
        for (const name of this.cssVariableNames) {
            this.clientService.streamTranslation("colors." + name).subscribe(value => {
                if (value && value != ("colors." + name)) {
                    this.changeCssVariable(name, value, renderer);
                    this.cssVariablesSubject.next(Object.assign({}, this.cssVariables));
                }
            });
        }
        setTimeout(() => {
            this.ready2.next(true);
        }, 200);
    }
    changeCssVariable(name, newValue, renderer) {
        this.cssVariables[name] = newValue;
        this.overrideCssProperties(renderer);
    }
    overrideCssProperties(renderer) {
        let style = '';
        for (const variable in this.cssVariables) {
            style += `${variable}: ${this.cssVariables[variable]};\n`;
        }
        if (this.element) {
            renderer.setProperty(this.element.nativeElement, 'style', style);
        }
    }
    save() {
        for (const variable in this.cssVariables) {
            this.clientService.next("colors." + variable, this.cssVariables[variable]);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: ChangeColorsService, deps: [{ token: i1.TranslationClientService }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: ChangeColorsService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: ChangeColorsService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: () => [{ type: i1.TranslationClientService }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbmdlLWNvbG9ycy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvY3VzdG9tLWRpc3BsYXkvc3JjL2xpYi9zZXJ2aWNlL2NoYW5nZS1jb2xvcnMtc2VydmljZS9jaGFuZ2UtY29sb3JzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFhLFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNoRSxPQUFPLEVBQUMsZUFBZSxFQUFFLGFBQWEsRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDOzs7QUFPbEUsTUFBTSxPQUFPLG1CQUFtQjtJQW1DOUIsWUFBb0IsYUFBdUM7UUFBdkMsa0JBQWEsR0FBYixhQUFhLENBQTBCO1FBbEMzRCxxQkFBZ0IsR0FBYTtZQUMzQix1QkFBdUI7WUFDdkIsdUJBQXVCO1lBQ3ZCLHVCQUF1QjtZQUN2Qix1QkFBdUI7WUFDdkIsdUJBQXVCO1lBQ3ZCLHVCQUF1QjtZQUN2Qix1QkFBdUI7WUFDdkIsY0FBYztZQUNkLG9CQUFvQjtZQUNwQixnQkFBZ0I7WUFDaEIsc0JBQXNCO1lBQ3RCLFdBQVc7WUFDWCxtQkFBbUI7WUFDbkIscUJBQXFCO1NBQ3RCLENBQUM7UUFDTSxpQkFBWSxHQUE4QixFQUFFLENBQUM7UUFDN0Msd0JBQW1CLEdBQThCLEVBQUUsQ0FBQztRQUM1RCx3QkFBbUIsR0FBdUMsSUFBSSxlQUFlLENBQTRCLEVBQUUsQ0FBQyxDQUFBO1FBQzVHLG1CQUFjLEdBQXNCLElBQUksZUFBZSxDQUFXLEVBQUUsQ0FBQyxDQUFBO1FBRXJFLG1CQUFjLEdBQTZCLElBQUksZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBSXBELFdBQU0sR0FBcUIsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUN6QyxXQUFNLEdBQXFCLElBQUksT0FBTyxFQUFFLENBQUM7UUFFMUQsVUFBSyxHQUF3QixhQUFhLENBQUMsQ0FB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R0FBRyxRQUFRLEtBQUssSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFBO1NBQzFEO1FBQ0QsSUFBRyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2YsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDbEU7SUFDSCxDQUFDO0lBRUQsSUFBSTtRQUNGLEtBQUssTUFBTSxRQUFRLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUN4QyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQTtTQUMzRTtJQUNILENBQUM7K0dBN0ZVLG1CQUFtQjttSEFBbkIsbUJBQW1CLGNBRmxCLE1BQU07OzRGQUVQLG1CQUFtQjtrQkFIL0IsVUFBVTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0VsZW1lbnRSZWYsIEluamVjdGFibGUsIFJlbmRlcmVyMn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0JlaGF2aW9yU3ViamVjdCwgY29tYmluZUxhdGVzdCwgbWFwLCBTdWJqZWN0fSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHtUcmFuc2xhdGlvbkNsaWVudFNlcnZpY2V9IGZyb20gXCIuLi90cmFuc2xhdGUvdHJhbnNsYXRpb24tY2xpZW50LnNlcnZpY2VcIjtcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcy9pbnRlcm5hbC9PYnNlcnZhYmxlJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgQ2hhbmdlQ29sb3JzU2VydmljZSB7XG4gIGNzc1ZhcmlhYmxlTmFtZXM6IHN0cmluZ1tdID0gW1xuICAgICctLWR5LWNvbG9yLTEtb3JpZ2luYWwnLFxuICAgICctLWR5LWNvbG9yLTItb3JpZ2luYWwnLFxuICAgICctLWR5LWNvbG9yLTMtb3JpZ2luYWwnLFxuICAgICctLWR5LWNvbG9yLTQtb3JpZ2luYWwnLFxuICAgICctLWR5LWNvbG9yLTUtb3JpZ2luYWwnLFxuICAgICctLWR5LWNvbG9yLTYtb3JpZ2luYWwnLFxuICAgICctLWR5LWNvbG9yLTctb3JpZ2luYWwnLFxuICAgICctLWR5LXByaW1hcnknLFxuICAgICctLWR5LXByaW1hcnktaG92ZXInLFxuICAgICctLWR5LXNlY29uZGFyeScsXG4gICAgJy0tZHktc2Vjb25kYXJ5LWhvdmVyJyxcbiAgICAnLS1keS10ZXh0JyxcbiAgICAnLS1keS10ZXh0LXByaW1hcnknLFxuICAgICctLWR5LXRleHQtc2Vjb25kYXJ5JyxcbiAgXTtcbiAgcHJpdmF0ZSBjc3NWYXJpYWJsZXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcbiAgcHJpdmF0ZSBwYWxldHRlQ3NzVmFyaWFibGVzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge307XG4gIGNzc1ZhcmlhYmxlc1N1YmplY3Q6IFN1YmplY3Q8eyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfT4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0+KHt9KVxuICBwYWxldHRlU3ViamVjdDogU3ViamVjdDxzdHJpbmdbXT4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHN0cmluZ1tdPihbXSlcblxuICBkaXNwbGF5U3ViamVjdDogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdChmYWxzZSlcbiAgcHJpdmF0ZSBlbGVtZW50PzogRWxlbWVudFJlZjtcblxuXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVhZHkxOiBTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IFN1YmplY3QoKTtcbiAgcHJpdmF0ZSByZWFkb25seSByZWFkeTI6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIHJlYWR5OiBPYnNlcnZhYmxlPGJvb2xlYW4+ID0gY29tYmluZUxhdGVzdChbdGhpcy5yZWFkeTEsIHRoaXMucmVhZHkyXSkucGlwZShcbiAgICBtYXAoKFt2YWwxLCB2YWwyXSkgPT4gdmFsMSAmJiB2YWwyKVxuICApO1xuXG5cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNsaWVudFNlcnZpY2U6IFRyYW5zbGF0aW9uQ2xpZW50U2VydmljZSkgeyB9XG5cbiAgZ2V0U3R5bGVzRnJvbUNzc0ZpbGUoKSB7XG4gICAgY29uc3Qgcm9vdFN0eWxlcyA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KTtcbiAgICB0aGlzLmNzc1ZhcmlhYmxlTmFtZXMuZm9yRWFjaCh2YXJpYWJsZSA9PiB7XG4gICAgICBpZihyb290U3R5bGVzLmdldFByb3BlcnR5VmFsdWUodmFyaWFibGUpLnRyaW0oKSkge1xuICAgICAgICBpZiAodmFyaWFibGUuaW5jbHVkZXMoJ29yaWdpbmFsJykpIHtcbiAgICAgICAgICB0aGlzLnBhbGV0dGVDc3NWYXJpYWJsZXNbdmFyaWFibGVdID0gcm9vdFN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKHZhcmlhYmxlKS50cmltKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuY3NzVmFyaWFibGVzW3ZhcmlhYmxlXSkge1xuICAgICAgICAgIHRoaXMuY3NzVmFyaWFibGVzW3ZhcmlhYmxlXSA9IHJvb3RTdHlsZXMuZ2V0UHJvcGVydHlWYWx1ZSh2YXJpYWJsZSkudHJpbSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5jc3NWYXJpYWJsZXNTdWJqZWN0Lm5leHQoT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jc3NWYXJpYWJsZXMpKVxuICAgIHRoaXMucGFsZXR0ZVN1YmplY3QubmV4dChPYmplY3QudmFsdWVzKHRoaXMucGFsZXR0ZUNzc1ZhcmlhYmxlcykpO1xuICAgIHRoaXMucmVhZHkxLm5leHQodHJ1ZSlcbiAgfVxuXG4gIHJlZ2lzdGVyRWxlbWVudFJlZihlbGVtZW50OiBFbGVtZW50UmVmKXtcbiAgICAvLyB1c2VkIGluIGFwcCBjb21wb25lbnRcbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICB9XG5cbiAgZ2V0U3R5bGVzRnJvbUNvbmZpZ0ZpbGUocmVuZGVyZXI6IFJlbmRlcmVyMikge1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiB0aGlzLmNzc1ZhcmlhYmxlTmFtZXMpIHtcbiAgICAgIHRoaXMuY2xpZW50U2VydmljZS5zdHJlYW1UcmFuc2xhdGlvbihcImNvbG9ycy5cIiArIG5hbWUpLnN1YnNjcmliZSh2YWx1ZSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSAhPSAoXCJjb2xvcnMuXCIgKyBuYW1lKSkge1xuICAgICAgICAgIHRoaXMuY2hhbmdlQ3NzVmFyaWFibGUobmFtZSwgdmFsdWUsIHJlbmRlcmVyKVxuICAgICAgICAgIHRoaXMuY3NzVmFyaWFibGVzU3ViamVjdC5uZXh0KE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY3NzVmFyaWFibGVzKSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnJlYWR5Mi5uZXh0KHRydWUpXG4gICAgfSwgMjAwKVxuICB9XG5cblxuICBjaGFuZ2VDc3NWYXJpYWJsZShuYW1lOiBzdHJpbmcsIG5ld1ZhbHVlOiBzdHJpbmcsIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgICB0aGlzLmNzc1ZhcmlhYmxlc1tuYW1lXSA9IG5ld1ZhbHVlO1xuXG4gICAgdGhpcy5vdmVycmlkZUNzc1Byb3BlcnRpZXMocmVuZGVyZXIpO1xuICB9XG5cbiAgb3ZlcnJpZGVDc3NQcm9wZXJ0aWVzKHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgICBsZXQgc3R5bGUgPSAnJztcbiAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIGluIHRoaXMuY3NzVmFyaWFibGVzKSB7XG4gICAgICBzdHlsZSArPSBgJHt2YXJpYWJsZX06ICR7dGhpcy5jc3NWYXJpYWJsZXNbdmFyaWFibGVdfTtcXG5gXG4gICAgfVxuICAgIGlmKHRoaXMuZWxlbWVudCkge1xuICAgICAgcmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsICdzdHlsZScsIHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICBzYXZlKCkge1xuICAgIGZvciAoY29uc3QgdmFyaWFibGUgaW4gdGhpcy5jc3NWYXJpYWJsZXMpIHtcbiAgICAgIHRoaXMuY2xpZW50U2VydmljZS5uZXh0KFwiY29sb3JzLlwiICsgdmFyaWFibGUsIHRoaXMuY3NzVmFyaWFibGVzW3ZhcmlhYmxlXSlcbiAgICB9XG4gIH1cbn1cbiJdfQ==