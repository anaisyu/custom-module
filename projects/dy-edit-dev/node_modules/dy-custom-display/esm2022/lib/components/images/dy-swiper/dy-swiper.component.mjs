import { Component, computed, Inject, input, PLATFORM_ID, signal } from '@angular/core';
import { isPlatformBrowser, NgForOf, NgIf } from "@angular/common";
import PhotoSwipeLightbox from "photoswipe/lightbox";
import PhotoSwipe from "photoswipe";
// import Swiper bundle with all modules installed
// @ts-ignore
import Swiper from 'swiper/bundle';
import { DyTransitionDirective } from "../../../directives/dy-transition.directive";
import { DyImgComponent } from "../tag/dy-img/dy-img.component";
import { MatIcon } from "@angular/material/icon";
import * as i0 from "@angular/core";
export class DySwiperComponent {
    constructor(_platformId) {
        this._platformId = _platformId;
        this.active_id = -1;
        this.pictures = input.required();
        this.id = input('swiper');
        this.noGallery = input(false);
        this.withGallery = computed(() => this.noGallery() ? false : this.pictures() ? this.pictures().length > 1 : false);
        this.slidesPerView = input(1);
        this.spaceBetween = input(0);
        this.themeColor = input('#646464');
        this.margin_x = input(5);
        this.transition = input('none');
        this.sizes = computed(() => {
            const map = new Map();
            this.pictures().forEach(pic => {
                map.set(pic.originalUrl, { height: signal(0), width: signal(0) });
            });
            return map;
        });
    }
    goto(id) {
        this.swiper.slideToLoop(id);
    }
    getThumbnailHeight(pictures) {
        return Math.min(100 / pictures.length, 33);
    }
    ngOnDestroy() {
        this.lightbox?.destroy();
        this.swiper?.destroy();
    }
    ngOnChanges(changes) {
        if (changes['pictures'] && changes['pictures'].previousValue) {
            // Check if inputChangeTrigger has changed
            // You can add more conditions based on your requirements
            this.ngOnDestroy();
            this.ngAfterViewInit();
        }
    }
    ngAfterViewInit() {
        if (isPlatformBrowser(this._platformId)) {
            this.swiper = new Swiper(`#${this.id()}`, {
                // Optional parameters
                loop: true,
                keyboard: {
                    enabled: true,
                    onlyInViewport: false,
                },
                // If we need pagination
                pagination: {
                    el: '.swiper-pagination',
                },
                // Navigation arrows
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                // Responsive breakpoints
                breakpoints: {
                    // when window width is >= 640px
                    640: {
                        navigation: {
                            nextEl: '.swiper-button-next-dy' + this.id(),
                            prevEl: '.swiper-button-prev-dy' + this.id(),
                        },
                        spaceBetween: this.spaceBetween(),
                        slidesPerView: this.slidesPerView(), // or 4 depending on your preference
                    },
                    // you can add more breakpoints if needed
                },
                // And if we need scrollbar
                scrollbar: {
                    hide: true,
                },
                on: {
                    slideChangeTransitionEnd: (swiper) => {
                        console.log(swiper.realIndex);
                        this.changeActiveIndex(swiper.realIndex);
                    }
                }
            });
            setTimeout(() => {
                this.lightbox = new PhotoSwipeLightbox({
                    gallery: `#${this.id()}`,
                    children: 'a',
                    pswpModule: PhotoSwipe,
                    zoom: true
                });
                this.lightbox.init();
            }, 100);
        }
    }
    changeActiveIndex(index) {
        this.active_id = index;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: DySwiperComponent, deps: [{ token: PLATFORM_ID }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.10", type: DySwiperComponent, isStandalone: true, selector: "app-dy-swiper", inputs: { pictures: { classPropertyName: "pictures", publicName: "pictures", isSignal: true, isRequired: true, transformFunction: null }, id: { classPropertyName: "id", publicName: "id", isSignal: true, isRequired: false, transformFunction: null }, noGallery: { classPropertyName: "noGallery", publicName: "noGallery", isSignal: true, isRequired: false, transformFunction: null }, slidesPerView: { classPropertyName: "slidesPerView", publicName: "slidesPerView", isSignal: true, isRequired: false, transformFunction: null }, spaceBetween: { classPropertyName: "spaceBetween", publicName: "spaceBetween", isSignal: true, isRequired: false, transformFunction: null }, themeColor: { classPropertyName: "themeColor", publicName: "themeColor", isSignal: true, isRequired: false, transformFunction: null }, margin_x: { classPropertyName: "margin_x", publicName: "margin_x", isSignal: true, isRequired: false, transformFunction: null }, transition: { classPropertyName: "transition", publicName: "transition", isSignal: true, isRequired: false, transformFunction: null } }, usesOnChanges: true, ngImport: i0, template: "<div [class.col-md-10]=\"withGallery()\" [class.col-md-12]=\"!withGallery()\" [style.--swiper-theme-color]=\"themeColor()\">\n  <div style=\"display: flex; align-items: center;\">\n    <div class=\"dy-arrow text-center\">\n      <mat-icon [class]=\"'swiper-button-prev-dy' + id()\" class=\"!w-full\" [inline]=\"true\"\n                style=\"font-size: 4rem; color: var(--dy-primary)\">chevron_left\n      </mat-icon>\n    </div>\n    <div class=\"dy-main\">\n      <div [id]=\"id()\" class=\"swiper\">\n        <!-- Additional required wrapper -->\n        <div class=\"swiper-wrapper\">\n          @for (picture of pictures(); track picture.originalUrl) {\n\n            <div class=\"swiper-slide\" id=\"{{ picture.originalUrl }}\">\n              <div class=\"picsum-img-wrapper\"\n              >\n                <div\n                  [style.padding-left]=\"margin_x() + '%'\"\n                  [style.padding-right]=\"margin_x() + '%'\"\n                >\n                  <a style=\"width: 100%\" [href]=\"picture.originalUrl\"\n                     [attr.data-pswp-width]=\"sizes().get(picture.originalUrl)!.width()*this.slidesPerView()\"\n                     [attr.data-pswp-height]=\"sizes().get(picture.originalUrl)!.height()*this.slidesPerView()\"\n                     class=\"img-link\" target=\"_blank\">\n                    <dy-img [imgStyle]=\"'width: 100%; height: auto;'\" [sizeRatio]=\"100/this.slidesPerView()\" [image]=\"picture\"\n                            [alt]=\"picture.alt ?? 'swiper image'\" [transitionName]=\"$first ? transition() : 'none'\"\n                            [(height)]=\"sizes().get(picture.originalUrl)!.height\"\n                            [(width)]=\"sizes().get(picture.originalUrl)!.width\"></dy-img>\n                  </a>\n                </div>\n              </div>\n            </div>\n          }\n        </div>\n        <div class=\"swiper-pagination\"></div>\n\n        <div class=\"swiper-button-prev\"></div>\n        <div class=\"swiper-button-next\"></div>\n      </div>\n    </div>\n    <div class=\"text-center dy-arrow\">\n      <mat-icon [class]=\"'swiper-button-next-dy' + id()\" class=\"text-primary-inverse !w-full\" [inline]=\"true\"\n                style=\"font-size: 4rem; color: var(--dy-primary)\">chevron_right\n      </mat-icon>\n    </div>\n  </div>\n  <div *ngIf=\"withGallery()\" class=\"row\">\n    <div class=\"hidden md:block col-md-2 position-relative\">\n      <div id=\"image-list-detail\">\n        <div class=\"ab\">\n          <ng-container *ngFor=\"let picture of pictures(); let i = index\">\n            <img (click)=\"goto(i)\"\n                 [class.ab_active]=\"i == active_id\"\n                 [src]=\"picture.thumbnailUrl\"\n                 [style.height]=\"getThumbnailHeight(pictures()) + '%'\"\n                 [style.width]=\"getThumbnailHeight(pictures()) + '%'\"\n                 alt=\"thumbnail\"\n                 class=\"cd\"\n            />\n          </ng-container>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n", styles: [".swiper{width:100%;height:auto}img{display:block;margin:auto;max-width:100%!important}#image-list-detail{height:100%;position:absolute;text-align:left;margin-left:0;margin-right:auto;display:flex;justify-content:flex-end}.ab{display:inline-block;height:100%;margin-left:auto!important;margin-right:0!important}.cd{display:block;padding:3px;margin-left:0;margin-right:auto;object-fit:cover;aspect-ratio:297/210}@media (min-width: 576px){.cd{width:auto!important}}@media (max-width: 576px){img{width:100%!important;margin:unset!important}.swiper{width:100%!important}.cd{display:inline;height:auto!important}#image-list-detail{height:fit-content!important}}.ab_active{padding:2px;border:rgb(215,224,243) solid 2px}::ng-deep .pswp__button{width:5rem!important;height:5.5rem!important}::ng-deep .pswp__icn{width:4rem!important;height:4rem!important}.img-link{display:block;width:fit-content;margin:auto}.material-symbols-outlined{font-size:4rem}@media (min-width: 768px){.dy-arrow{width:4rem;color:var(--dy-primary)}.dy-main{width:calc(100% - 8rem)}}@media (max-width: 768px){.dy-arrow{display:none;width:0;color:var(--dy-primary)}.dy-main{width:100%}}.swiper-button-next,.swiper-button-prev{display:block}@media (min-width: 768px){.swiper-button-next,.swiper-button-prev{display:none}}\n"], dependencies: [{ kind: "directive", type: NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: DyImgComponent, selector: "dy-img", inputs: ["imgClass", "imgStyle", "image", "alt", "transitionName", "sizeRatio", "height", "width"], outputs: ["heightChange", "widthChange"] }, { kind: "component", type: MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: DySwiperComponent, decorators: [{
            type: Component,
            args: [{ selector: 'app-dy-swiper', standalone: true, imports: [
                        NgForOf,
                        NgIf,
                        DyTransitionDirective,
                        DyImgComponent,
                        MatIcon
                    ], template: "<div [class.col-md-10]=\"withGallery()\" [class.col-md-12]=\"!withGallery()\" [style.--swiper-theme-color]=\"themeColor()\">\n  <div style=\"display: flex; align-items: center;\">\n    <div class=\"dy-arrow text-center\">\n      <mat-icon [class]=\"'swiper-button-prev-dy' + id()\" class=\"!w-full\" [inline]=\"true\"\n                style=\"font-size: 4rem; color: var(--dy-primary)\">chevron_left\n      </mat-icon>\n    </div>\n    <div class=\"dy-main\">\n      <div [id]=\"id()\" class=\"swiper\">\n        <!-- Additional required wrapper -->\n        <div class=\"swiper-wrapper\">\n          @for (picture of pictures(); track picture.originalUrl) {\n\n            <div class=\"swiper-slide\" id=\"{{ picture.originalUrl }}\">\n              <div class=\"picsum-img-wrapper\"\n              >\n                <div\n                  [style.padding-left]=\"margin_x() + '%'\"\n                  [style.padding-right]=\"margin_x() + '%'\"\n                >\n                  <a style=\"width: 100%\" [href]=\"picture.originalUrl\"\n                     [attr.data-pswp-width]=\"sizes().get(picture.originalUrl)!.width()*this.slidesPerView()\"\n                     [attr.data-pswp-height]=\"sizes().get(picture.originalUrl)!.height()*this.slidesPerView()\"\n                     class=\"img-link\" target=\"_blank\">\n                    <dy-img [imgStyle]=\"'width: 100%; height: auto;'\" [sizeRatio]=\"100/this.slidesPerView()\" [image]=\"picture\"\n                            [alt]=\"picture.alt ?? 'swiper image'\" [transitionName]=\"$first ? transition() : 'none'\"\n                            [(height)]=\"sizes().get(picture.originalUrl)!.height\"\n                            [(width)]=\"sizes().get(picture.originalUrl)!.width\"></dy-img>\n                  </a>\n                </div>\n              </div>\n            </div>\n          }\n        </div>\n        <div class=\"swiper-pagination\"></div>\n\n        <div class=\"swiper-button-prev\"></div>\n        <div class=\"swiper-button-next\"></div>\n      </div>\n    </div>\n    <div class=\"text-center dy-arrow\">\n      <mat-icon [class]=\"'swiper-button-next-dy' + id()\" class=\"text-primary-inverse !w-full\" [inline]=\"true\"\n                style=\"font-size: 4rem; color: var(--dy-primary)\">chevron_right\n      </mat-icon>\n    </div>\n  </div>\n  <div *ngIf=\"withGallery()\" class=\"row\">\n    <div class=\"hidden md:block col-md-2 position-relative\">\n      <div id=\"image-list-detail\">\n        <div class=\"ab\">\n          <ng-container *ngFor=\"let picture of pictures(); let i = index\">\n            <img (click)=\"goto(i)\"\n                 [class.ab_active]=\"i == active_id\"\n                 [src]=\"picture.thumbnailUrl\"\n                 [style.height]=\"getThumbnailHeight(pictures()) + '%'\"\n                 [style.width]=\"getThumbnailHeight(pictures()) + '%'\"\n                 alt=\"thumbnail\"\n                 class=\"cd\"\n            />\n          </ng-container>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n", styles: [".swiper{width:100%;height:auto}img{display:block;margin:auto;max-width:100%!important}#image-list-detail{height:100%;position:absolute;text-align:left;margin-left:0;margin-right:auto;display:flex;justify-content:flex-end}.ab{display:inline-block;height:100%;margin-left:auto!important;margin-right:0!important}.cd{display:block;padding:3px;margin-left:0;margin-right:auto;object-fit:cover;aspect-ratio:297/210}@media (min-width: 576px){.cd{width:auto!important}}@media (max-width: 576px){img{width:100%!important;margin:unset!important}.swiper{width:100%!important}.cd{display:inline;height:auto!important}#image-list-detail{height:fit-content!important}}.ab_active{padding:2px;border:rgb(215,224,243) solid 2px}::ng-deep .pswp__button{width:5rem!important;height:5.5rem!important}::ng-deep .pswp__icn{width:4rem!important;height:4rem!important}.img-link{display:block;width:fit-content;margin:auto}.material-symbols-outlined{font-size:4rem}@media (min-width: 768px){.dy-arrow{width:4rem;color:var(--dy-primary)}.dy-main{width:calc(100% - 8rem)}}@media (max-width: 768px){.dy-arrow{display:none;width:0;color:var(--dy-primary)}.dy-main{width:100%}}.swiper-button-next,.swiper-button-prev{display:block}@media (min-width: 768px){.swiper-button-next,.swiper-button-prev{display:none}}\n"] }]
        }], ctorParameters: () => [{ type: Object, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHktc3dpcGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2N1c3RvbS1kaXNwbGF5L3NyYy9saWIvY29tcG9uZW50cy9pbWFnZXMvZHktc3dpcGVyL2R5LXN3aXBlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9jdXN0b20tZGlzcGxheS9zcmMvbGliL2NvbXBvbmVudHMvaW1hZ2VzL2R5LXN3aXBlci9keS1zd2lwZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxRQUFRLEVBQ1IsTUFBTSxFQUNOLEtBQUssRUFJTCxXQUFXLEVBQ1gsTUFBTSxFQUdQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDakUsT0FBTyxrQkFBa0IsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUM7QUFDcEMsa0RBQWtEO0FBQ2xELGFBQWE7QUFDYixPQUFPLE1BQU0sTUFBTSxlQUFlLENBQUM7QUFFbkMsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0sNkNBQTZDLENBQUM7QUFDbEYsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLGdDQUFnQyxDQUFDO0FBQzlELE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSx3QkFBd0IsQ0FBQzs7QUFlL0MsTUFBTSxPQUFPLGlCQUFpQjtJQXFCNUIsWUFBeUMsV0FBbUI7UUFBbkIsZ0JBQVcsR0FBWCxXQUFXLENBQVE7UUFwQjVELGNBQVMsR0FBVyxDQUFDLENBQUMsQ0FBQztRQUN2QixhQUFRLEdBQWdDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN6RCxPQUFFLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFB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SSxXQUNQO3dCQUNQLE9BQU87d0JBQ1AsSUFBSTt3QkFDSixxQkFBcUI7d0JBQ3JCLGNBQWM7d0JBQ2QsT0FBTztxQkFDUjs7MEJBeUJZLE1BQU07MkJBQUMsV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENvbXBvbmVudCxcbiAgY29tcHV0ZWQsXG4gIEluamVjdCxcbiAgaW5wdXQsXG4gIElucHV0U2lnbmFsLFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgUExBVEZPUk1fSUQsXG4gIHNpZ25hbCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgV3JpdGFibGVTaWduYWxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge2lzUGxhdGZvcm1Ccm93c2VyLCBOZ0Zvck9mLCBOZ0lmfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uXCI7XG5pbXBvcnQgUGhvdG9Td2lwZUxpZ2h0Ym94IGZyb20gXCJwaG90b3N3aXBlL2xpZ2h0Ym94XCI7XG5pbXBvcnQgUGhvdG9Td2lwZSBmcm9tIFwicGhvdG9zd2lwZVwiO1xuLy8gaW1wb3J0IFN3aXBlciBidW5kbGUgd2l0aCBhbGwgbW9kdWxlcyBpbnN0YWxsZWRcbi8vIEB0cy1pZ25vcmVcbmltcG9ydCBTd2lwZXIgZnJvbSAnc3dpcGVyL2J1bmRsZSc7XG5pbXBvcnQge0R5SW1hZ2V9IGZyb20gXCIuLi8uLi8uLi9tb2RlbC9pbWFnZXMvZHktaW1hZ2VcIjtcbmltcG9ydCB7RHlUcmFuc2l0aW9uRGlyZWN0aXZlfSBmcm9tIFwiLi4vLi4vLi4vZGlyZWN0aXZlcy9keS10cmFuc2l0aW9uLmRpcmVjdGl2ZVwiO1xuaW1wb3J0IHtEeUltZ0NvbXBvbmVudH0gZnJvbSBcIi4uL3RhZy9keS1pbWcvZHktaW1nLmNvbXBvbmVudFwiO1xuaW1wb3J0IHtNYXRJY29ufSBmcm9tIFwiQGFuZ3VsYXIvbWF0ZXJpYWwvaWNvblwiO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhcHAtZHktc3dpcGVyJyxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIE5nRm9yT2YsXG4gICAgTmdJZixcbiAgICBEeVRyYW5zaXRpb25EaXJlY3RpdmUsXG4gICAgRHlJbWdDb21wb25lbnQsXG4gICAgTWF0SWNvblxuICBdLFxuICB0ZW1wbGF0ZVVybDogJy4vZHktc3dpcGVyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmw6ICcuL2R5LXN3aXBlci5jb21wb25lbnQuc2Nzcydcbn0pXG5leHBvcnQgY2xhc3MgRHlTd2lwZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcyB7XG4gIGFjdGl2ZV9pZDogbnVtYmVyID0gLTE7XG4gIHBpY3R1cmVzOiBJbnB1dFNpZ25hbDxBcnJheTxEeUltYWdlPj4gPSBpbnB1dC5yZXF1aXJlZCgpO1xuICBpZCA9IGlucHV0KCdzd2lwZXInKVxuICBub0dhbGxlcnkgPSBpbnB1dChmYWxzZSlcbiAgd2l0aEdhbGxlcnkgPSBjb21wdXRlZCgoKSA9PiB0aGlzLm5vR2FsbGVyeSgpID8gZmFsc2UgOiB0aGlzLnBpY3R1cmVzKCkgPyB0aGlzLnBpY3R1cmVzKCkubGVuZ3RoID4gMSA6IGZhbHNlKTtcbiAgc2xpZGVzUGVyVmlldyA9IGlucHV0KDEpXG4gIHNwYWNlQmV0d2VlbiA9IGlucHV0KDApXG4gIHRoZW1lQ29sb3IgPSBpbnB1dCgnIzY0NjQ2NCcpXG4gIG1hcmdpbl94OiBJbnB1dFNpZ25hbDxudW1iZXI+ID0gaW5wdXQoNSk7XG4gIHRyYW5zaXRpb246IElucHV0U2lnbmFsPHN0cmluZz4gPSBpbnB1dCgnbm9uZScpO1xuICBzaXplcyA9IGNvbXB1dGVkKCgpID0+IHtcbiAgICBjb25zdCBtYXAgPSBuZXcgTWFwPHN0cmluZywgeyBoZWlnaHQ6IFdyaXRhYmxlU2lnbmFsPG51bWJlcj4sIHdpZHRoOiBXcml0YWJsZVNpZ25hbDxudW1iZXI+IH0+KCk7XG4gICAgdGhpcy5waWN0dXJlcygpLmZvckVhY2gocGljID0+IHtcbiAgICAgIG1hcC5zZXQocGljLm9yaWdpbmFsVXJsLCB7aGVpZ2h0OiBzaWduYWwoMCksIHdpZHRoOiBzaWduYWwoMCl9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gbWFwXG4gIH0pXG4gIHByaXZhdGUgc3dpcGVyPzogU3dpcGVyO1xuICBwcml2YXRlIGxpZ2h0Ym94PzogUGhvdG9Td2lwZUxpZ2h0Ym94O1xuXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgX3BsYXRmb3JtSWQ6IE9iamVjdCkge1xuICB9XG5cblxuICBnb3RvKGlkOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnN3aXBlciEuc2xpZGVUb0xvb3AoaWQpXG4gIH1cblxuXG4gIGdldFRodW1ibmFpbEhlaWdodChwaWN0dXJlczogQXJyYXk8RHlJbWFnZT4pIHtcbiAgICByZXR1cm4gTWF0aC5taW4oMTAwIC8gcGljdHVyZXMubGVuZ3RoLCAzMyk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmxpZ2h0Ym94Py5kZXN0cm95KClcbiAgICB0aGlzLnN3aXBlcj8uZGVzdHJveSgpXG4gIH1cblxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlc1sncGljdHVyZXMnXSAmJiBjaGFuZ2VzWydwaWN0dXJlcyddLnByZXZpb3VzVmFsdWUpIHtcbiAgICAgIC8vIENoZWNrIGlmIGlucHV0Q2hhbmdlVHJpZ2dlciBoYXMgY2hhbmdlZFxuICAgICAgLy8gWW91IGNhbiBhZGQgbW9yZSBjb25kaXRpb25zIGJhc2VkIG9uIHlvdXIgcmVxdWlyZW1lbnRzXG4gICAgICB0aGlzLm5nT25EZXN0cm95KClcbiAgICAgIHRoaXMubmdBZnRlclZpZXdJbml0KClcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMuX3BsYXRmb3JtSWQpKSB7XG4gICAgICB0aGlzLnN3aXBlciA9IG5ldyBTd2lwZXIoYCMke3RoaXMuaWQoKX1gLCB7XG4gICAgICAgIC8vIE9wdGlvbmFsIHBhcmFtZXRlcnNcbiAgICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgICAga2V5Ym9hcmQ6IHtcbiAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgIG9ubHlJblZpZXdwb3J0OiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAgLy8gSWYgd2UgbmVlZCBwYWdpbmF0aW9uXG4gICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICBlbDogJy5zd2lwZXItcGFnaW5hdGlvbicsXG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gTmF2aWdhdGlvbiBhcnJvd3NcbiAgICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICAgIG5leHRFbDogJy5zd2lwZXItYnV0dG9uLW5leHQnLFxuICAgICAgICAgIHByZXZFbDogJy5zd2lwZXItYnV0dG9uLXByZXYnLFxuICAgICAgICB9LFxuICAgICAgICAvLyBSZXNwb25zaXZlIGJyZWFrcG9pbnRzXG4gICAgICAgIGJyZWFrcG9pbnRzOiB7XG4gICAgICAgICAgLy8gd2hlbiB3aW5kb3cgd2lkdGggaXMgPj0gNjQwcHhcbiAgICAgICAgICA2NDA6IHtcbiAgICAgICAgICAgIG5hdmlnYXRpb246IHtcbiAgICAgICAgICAgICAgbmV4dEVsOiAnLnN3aXBlci1idXR0b24tbmV4dC1keScgKyB0aGlzLmlkKCksXG4gICAgICAgICAgICAgIHByZXZFbDogJy5zd2lwZXItYnV0dG9uLXByZXYtZHknICsgdGhpcy5pZCgpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNwYWNlQmV0d2VlbjogdGhpcy5zcGFjZUJldHdlZW4oKSxcbiAgICAgICAgICAgIHNsaWRlc1BlclZpZXc6IHRoaXMuc2xpZGVzUGVyVmlldygpLCAvLyBvciA0IGRlcGVuZGluZyBvbiB5b3VyIHByZWZlcmVuY2VcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIHlvdSBjYW4gYWRkIG1vcmUgYnJlYWtwb2ludHMgaWYgbmVlZGVkXG4gICAgICAgIH0sXG4gICAgICAgIC8vIEFuZCBpZiB3ZSBuZWVkIHNjcm9sbGJhclxuICAgICAgICBzY3JvbGxiYXI6IHtcbiAgICAgICAgICBoaWRlOiB0cnVlLFxuICAgICAgICB9LFxuXG4gICAgICAgIG9uOiB7XG4gICAgICAgICAgc2xpZGVDaGFuZ2VUcmFuc2l0aW9uRW5kOiAoc3dpcGVyOiBTd2lwZXIpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHN3aXBlci5yZWFsSW5kZXgpXG4gICAgICAgICAgICB0aGlzLmNoYW5nZUFjdGl2ZUluZGV4KHN3aXBlci5yZWFsSW5kZXgpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMubGlnaHRib3ggPSBuZXcgUGhvdG9Td2lwZUxpZ2h0Ym94KHtcbiAgICAgICAgICBnYWxsZXJ5OiBgIyR7dGhpcy5pZCgpfWAsXG4gICAgICAgICAgY2hpbGRyZW46ICdhJyxcbiAgICAgICAgICBwc3dwTW9kdWxlOiBQaG90b1N3aXBlLFxuICAgICAgICAgIHpvb206IHRydWVcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5saWdodGJveC5pbml0KClcbiAgICAgIH0sIDEwMCk7XG4gICAgfVxuICB9XG5cbiAgY2hhbmdlQWN0aXZlSW5kZXgoaW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuYWN0aXZlX2lkID0gaW5kZXg7XG4gIH1cblxufVxuIiwiPGRpdiBbY2xhc3MuY29sLW1kLTEwXT1cIndpdGhHYWxsZXJ5KClcIiBbY2xhc3MuY29sLW1kLTEyXT1cIiF3aXRoR2FsbGVyeSgpXCIgW3N0eWxlLi0tc3dpcGVyLXRoZW1lLWNvbG9yXT1cInRoZW1lQ29sb3IoKVwiPlxuICA8ZGl2IHN0eWxlPVwiZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjtcIj5cbiAgICA8ZGl2IGNsYXNzPVwiZHktYXJyb3cgdGV4dC1jZW50ZXJcIj5cbiAgICAgIDxtYXQtaWNvbiBbY2xhc3NdPVwiJ3N3aXBlci1idXR0b24tcHJldi1keScgKyBpZCgpXCIgY2xhc3M9XCIhdy1mdWxsXCIgW2lubGluZV09XCJ0cnVlXCJcbiAgICAgICAgICAgICAgICBzdHlsZT1cImZvbnQtc2l6ZTogNHJlbTsgY29sb3I6IHZhcigtLWR5LXByaW1hcnkpXCI+Y2hldnJvbl9sZWZ0XG4gICAgICA8L21hdC1pY29uPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJkeS1tYWluXCI+XG4gICAgICA8ZGl2IFtpZF09XCJpZCgpXCIgY2xhc3M9XCJzd2lwZXJcIj5cbiAgICAgICAgPCEtLSBBZGRpdGlvbmFsIHJlcXVpcmVkIHdyYXBwZXIgLS0+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzd2lwZXItd3JhcHBlclwiPlxuICAgICAgICAgIEBmb3IgKHBpY3R1cmUgb2YgcGljdHVyZXMoKTsgdHJhY2sgcGljdHVyZS5vcmlnaW5hbFVybCkge1xuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3dpcGVyLXNsaWRlXCIgaWQ9XCJ7eyBwaWN0dXJlLm9yaWdpbmFsVXJsIH19XCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwaWNzdW0taW1nLXdyYXBwZXJcIlxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgW3N0eWxlLnBhZGRpbmctbGVmdF09XCJtYXJnaW5feCgpICsgJyUnXCJcbiAgICAgICAgICAgICAgICAgIFtzdHlsZS5wYWRkaW5nLXJpZ2h0XT1cIm1hcmdpbl94KCkgKyAnJSdcIlxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIDxhIHN0eWxlPVwid2lkdGg6IDEwMCVcIiBbaHJlZl09XCJwaWN0dXJlLm9yaWdpbmFsVXJsXCJcbiAgICAgICAgICAgICAgICAgICAgIFthdHRyLmRhdGEtcHN3cC13aWR0aF09XCJzaXplcygpLmdldChwaWN0dXJlLm9yaWdpbmFsVXJsKSEud2lkdGgoKSp0aGlzLnNsaWRlc1BlclZpZXcoKVwiXG4gICAgICAgICAgICAgICAgICAgICBbYXR0ci5kYXRhLXBzd3AtaGVpZ2h0XT1cInNpemVzKCkuZ2V0KHBpY3R1cmUub3JpZ2luYWxVcmwpIS5oZWlnaHQoKSp0aGlzLnNsaWRlc1BlclZpZXcoKVwiXG4gICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImltZy1saW5rXCIgdGFyZ2V0PVwiX2JsYW5rXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkeS1pbWcgW2ltZ1N0eWxlXT1cIid3aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOydcIiBbc2l6ZVJhdGlvXT1cIjEwMC90aGlzLnNsaWRlc1BlclZpZXcoKVwiIFtpbWFnZV09XCJwaWN0dXJlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbYWx0XT1cInBpY3R1cmUuYWx0ID8/ICdzd2lwZXIgaW1hZ2UnXCIgW3RyYW5zaXRpb25OYW1lXT1cIiRmaXJzdCA/IHRyYW5zaXRpb24oKSA6ICdub25lJ1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgWyhoZWlnaHQpXT1cInNpemVzKCkuZ2V0KHBpY3R1cmUub3JpZ2luYWxVcmwpIS5oZWlnaHRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsod2lkdGgpXT1cInNpemVzKCkuZ2V0KHBpY3R1cmUub3JpZ2luYWxVcmwpIS53aWR0aFwiPjwvZHktaW1nPlxuICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIH1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzd2lwZXItcGFnaW5hdGlvblwiPjwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJzd2lwZXItYnV0dG9uLXByZXZcIj48L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInN3aXBlci1idXR0b24tbmV4dFwiPjwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyIGR5LWFycm93XCI+XG4gICAgICA8bWF0LWljb24gW2NsYXNzXT1cIidzd2lwZXItYnV0dG9uLW5leHQtZHknICsgaWQoKVwiIGNsYXNzPVwidGV4dC1wcmltYXJ5LWludmVyc2UgIXctZnVsbFwiIFtpbmxpbmVdPVwidHJ1ZVwiXG4gICAgICAgICAgICAgICAgc3R5bGU9XCJmb250LXNpemU6IDRyZW07IGNvbG9yOiB2YXIoLS1keS1wcmltYXJ5KVwiPmNoZXZyb25fcmlnaHRcbiAgICAgIDwvbWF0LWljb24+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuICA8ZGl2ICpuZ0lmPVwid2l0aEdhbGxlcnkoKVwiIGNsYXNzPVwicm93XCI+XG4gICAgPGRpdiBjbGFzcz1cImhpZGRlbiBtZDpibG9jayBjb2wtbWQtMiBwb3NpdGlvbi1yZWxhdGl2ZVwiPlxuICAgICAgPGRpdiBpZD1cImltYWdlLWxpc3QtZGV0YWlsXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJhYlwiPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IHBpY3R1cmUgb2YgcGljdHVyZXMoKTsgbGV0IGkgPSBpbmRleFwiPlxuICAgICAgICAgICAgPGltZyAoY2xpY2spPVwiZ290byhpKVwiXG4gICAgICAgICAgICAgICAgIFtjbGFzcy5hYl9hY3RpdmVdPVwiaSA9PSBhY3RpdmVfaWRcIlxuICAgICAgICAgICAgICAgICBbc3JjXT1cInBpY3R1cmUudGh1bWJuYWlsVXJsXCJcbiAgICAgICAgICAgICAgICAgW3N0eWxlLmhlaWdodF09XCJnZXRUaHVtYm5haWxIZWlnaHQocGljdHVyZXMoKSkgKyAnJSdcIlxuICAgICAgICAgICAgICAgICBbc3R5bGUud2lkdGhdPVwiZ2V0VGh1bWJuYWlsSGVpZ2h0KHBpY3R1cmVzKCkpICsgJyUnXCJcbiAgICAgICAgICAgICAgICAgYWx0PVwidGh1bWJuYWlsXCJcbiAgICAgICAgICAgICAgICAgY2xhc3M9XCJjZFwiXG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuIl19