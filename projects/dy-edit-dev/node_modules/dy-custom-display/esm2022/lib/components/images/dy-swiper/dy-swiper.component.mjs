import { Component, computed, Inject, input, PLATFORM_ID, signal } from '@angular/core';
import { isPlatformBrowser, NgForOf, NgIf } from "@angular/common";
import PhotoSwipeLightbox from "photoswipe/lightbox";
import PhotoSwipe from "photoswipe";
// import Swiper bundle with all modules installed
// @ts-ignore
import Swiper from 'swiper/bundle';
import { DyTransitionDirective } from "../../../directives/dy-transition.directive";
import { DyImgComponent } from "../tag/dy-img/dy-img.component";
import * as i0 from "@angular/core";
export class DySwiperComponent {
    constructor(_platformId) {
        this._platformId = _platformId;
        this.active_id = -1;
        this.pictures = input.required();
        this.id = input('swiper');
        this.noGallery = input(false);
        this.withGallery = computed(() => this.noGallery() ? false : this.pictures() ? this.pictures().length > 1 : false);
        this.slidesPerView = input(1);
        this.spaceBetween = input(0);
        this.themeColor = input('#646464');
        this.margin_x = input(5);
        this.transition = input('none');
        this.sizes = computed(() => {
            const map = new Map();
            this.pictures().forEach(pic => {
                map.set(pic.originalUrl, { height: signal(0), width: signal(0) });
            });
            return map;
        });
    }
    goto(id) {
        this.swiper.slideToLoop(id);
    }
    getThumbnailHeight(pictures) {
        return Math.min(100 / pictures.length, 33);
    }
    ngOnDestroy() {
        this.lightbox?.destroy();
        this.swiper?.destroy();
    }
    ngOnChanges(changes) {
        if (changes['pictures'] && changes['pictures'].previousValue) {
            // Check if inputChangeTrigger has changed
            // You can add more conditions based on your requirements
            this.ngOnDestroy();
            this.ngAfterViewInit();
        }
    }
    ngAfterViewInit() {
        if (isPlatformBrowser(this._platformId)) {
            this.swiper = new Swiper(`#${this.id()}`, {
                // Optional parameters
                loop: true,
                keyboard: {
                    enabled: true,
                    onlyInViewport: false,
                },
                // If we need pagination
                pagination: {
                    el: '.swiper-pagination',
                },
                // Navigation arrows
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                // Responsive breakpoints
                breakpoints: {
                    // when window width is >= 640px
                    640: {
                        navigation: {
                            nextEl: '.swiper-button-next-dy' + this.id(),
                            prevEl: '.swiper-button-prev-dy' + this.id(),
                        },
                        spaceBetween: this.spaceBetween(),
                        slidesPerView: this.slidesPerView(), // or 4 depending on your preference
                    },
                    // you can add more breakpoints if needed
                },
                // And if we need scrollbar
                scrollbar: {
                    hide: true,
                },
                on: {
                    slideChangeTransitionEnd: (swiper) => {
                        console.log(swiper.realIndex);
                        this.changeActiveIndex(swiper.realIndex);
                    }
                }
            });
            setTimeout(() => {
                this.lightbox = new PhotoSwipeLightbox({
                    gallery: `#${this.id()}`,
                    children: 'a',
                    pswpModule: PhotoSwipe,
                    zoom: true
                });
                this.lightbox.init();
            }, 100);
        }
    }
    changeActiveIndex(index) {
        this.active_id = index;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: DySwiperComponent, deps: [{ token: PLATFORM_ID }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.10", type: DySwiperComponent, isStandalone: true, selector: "app-dy-swiper", inputs: { pictures: { classPropertyName: "pictures", publicName: "pictures", isSignal: true, isRequired: true, transformFunction: null }, id: { classPropertyName: "id", publicName: "id", isSignal: true, isRequired: false, transformFunction: null }, noGallery: { classPropertyName: "noGallery", publicName: "noGallery", isSignal: true, isRequired: false, transformFunction: null }, slidesPerView: { classPropertyName: "slidesPerView", publicName: "slidesPerView", isSignal: true, isRequired: false, transformFunction: null }, spaceBetween: { classPropertyName: "spaceBetween", publicName: "spaceBetween", isSignal: true, isRequired: false, transformFunction: null }, themeColor: { classPropertyName: "themeColor", publicName: "themeColor", isSignal: true, isRequired: false, transformFunction: null }, margin_x: { classPropertyName: "margin_x", publicName: "margin_x", isSignal: true, isRequired: false, transformFunction: null }, transition: { classPropertyName: "transition", publicName: "transition", isSignal: true, isRequired: false, transformFunction: null } }, usesOnChanges: true, ngImport: i0, template: "<div [class.col-md-10]=\"withGallery()\" [class.col-md-12]=\"!withGallery()\" [style.--swiper-theme-color]=\"themeColor()\">\n  <div style=\"display: flex; align-items: center;\">\n    <div class=\"dy-arrow text-center\">\n      <i [class]=\"'swiper-button-prev-dy' + id()\"><span\n        class=\"material-symbols-outlined\">chevron_left</span></i>\n    </div>\n    <div class=\"dy-main\">\n      <div [id]=\"id()\" class=\"swiper\">\n        <!-- Additional required wrapper -->\n        <div class=\"swiper-wrapper\">\n          @for (picture of pictures(); track picture.originalUrl) {\n\n            <div class=\"swiper-slide\" id=\"{{ picture.originalUrl }}\">\n              <div class=\"picsum-img-wrapper\"\n              >\n                <div\n                  [style.padding-left]=\"margin_x() + '%'\"\n                  [style.padding-right]=\"margin_x() + '%'\"\n                >\n                  <a [href]=\"picture.originalUrl\"\n                     [attr.data-pswp-width]=\"sizes().get(picture.originalUrl)!.width()*this.slidesPerView()\"\n                     [attr.data-pswp-height]=\"sizes().get(picture.originalUrl)!.height()*this.slidesPerView()\"\n                     class=\"img-link\" target=\"_blank\">\n                    <dy-img [imgStyle]=\"'width: 100%; height: auto;'\" [sizeRatio]=\"100/this.slidesPerView()\" [image]=\"picture\"\n                            [alt]=\"picture.alt ?? 'swiper image'\" [transitionName]=\"$first ? transition() : 'none'\"\n                            [(height)]=\"sizes().get(picture.originalUrl)!.height\"\n                            [(width)]=\"sizes().get(picture.originalUrl)!.width\"></dy-img>\n                  </a>\n                </div>\n              </div>\n            </div>\n          }\n        </div>\n        <div class=\"swiper-pagination\"></div>\n\n        <div class=\"swiper-button-prev\"></div>\n        <div class=\"swiper-button-next\"></div>\n      </div>\n    </div>\n    <div class=\"text-center dy-arrow\">\n      <i [class]=\"'swiper-button-next-dy' + id()\"><span\n        class=\"material-symbols-outlined\">chevron_right</span></i>\n    </div>\n  </div>\n  <div *ngIf=\"withGallery()\" class=\"row\">\n    <div class=\"hidden md:block col-md-2 position-relative\">\n      <div id=\"image-list-detail\">\n        <div class=\"ab\">\n          <ng-container *ngFor=\"let picture of pictures(); let i = index\">\n            <img (click)=\"goto(i)\"\n                 [class.ab_active]=\"i == active_id\"\n                 [src]=\"picture.thumbnailUrl\"\n                 [style.height]=\"getThumbnailHeight(pictures()) + '%'\"\n                 [style.width]=\"getThumbnailHeight(pictures()) + '%'\"\n                 alt=\"thumbnail\"\n                 class=\"cd\"\n            />\n          </ng-container>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n", styles: [".swiper{width:100%;height:auto}img{display:block;margin:auto;max-width:100%!important}#image-list-detail{height:100%;position:absolute;text-align:left;margin-left:0;margin-right:auto;display:flex;justify-content:flex-end}.ab{display:inline-block;height:100%;margin-left:auto!important;margin-right:0!important}.cd{display:block;padding:3px;margin-left:0;margin-right:auto;object-fit:cover;aspect-ratio:297/210}@media (min-width: 576px){.cd{width:auto!important}}@media (max-width: 576px){img{width:100%!important;margin:unset!important}.swiper{width:100%!important}.cd{display:inline;height:auto!important}#image-list-detail{height:fit-content!important}}.ab_active{padding:2px;border:rgb(215,224,243) solid 2px}::ng-deep .pswp__button{width:5rem!important;height:5.5rem!important}::ng-deep .pswp__icn{width:4rem!important;height:4rem!important}.img-link{display:block;width:fit-content;margin:auto}.material-symbols-outlined{font-size:4rem}@media (min-width: 768px){.dy-arrow{width:4%;color:var(--dy-primary)}.dy-main{width:92%}}@media (max-width: 768px){.dy-arrow{display:none;width:0;color:var(--dy-primary)}.dy-main{width:100%}}.swiper-button-next,.swiper-button-prev{display:block}@media (min-width: 768px){.swiper-button-next,.swiper-button-prev{display:none}}\n"], dependencies: [{ kind: "directive", type: NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: DyImgComponent, selector: "dy-img", inputs: ["imgClass", "imgStyle", "image", "alt", "transitionName", "sizeRatio", "height", "width"], outputs: ["heightChange", "widthChange"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.10", ngImport: i0, type: DySwiperComponent, decorators: [{
            type: Component,
            args: [{ selector: 'app-dy-swiper', standalone: true, imports: [
                        NgForOf,
                        NgIf,
                        DyTransitionDirective,
                        DyImgComponent
                    ], template: "<div [class.col-md-10]=\"withGallery()\" [class.col-md-12]=\"!withGallery()\" [style.--swiper-theme-color]=\"themeColor()\">\n  <div style=\"display: flex; align-items: center;\">\n    <div class=\"dy-arrow text-center\">\n      <i [class]=\"'swiper-button-prev-dy' + id()\"><span\n        class=\"material-symbols-outlined\">chevron_left</span></i>\n    </div>\n    <div class=\"dy-main\">\n      <div [id]=\"id()\" class=\"swiper\">\n        <!-- Additional required wrapper -->\n        <div class=\"swiper-wrapper\">\n          @for (picture of pictures(); track picture.originalUrl) {\n\n            <div class=\"swiper-slide\" id=\"{{ picture.originalUrl }}\">\n              <div class=\"picsum-img-wrapper\"\n              >\n                <div\n                  [style.padding-left]=\"margin_x() + '%'\"\n                  [style.padding-right]=\"margin_x() + '%'\"\n                >\n                  <a [href]=\"picture.originalUrl\"\n                     [attr.data-pswp-width]=\"sizes().get(picture.originalUrl)!.width()*this.slidesPerView()\"\n                     [attr.data-pswp-height]=\"sizes().get(picture.originalUrl)!.height()*this.slidesPerView()\"\n                     class=\"img-link\" target=\"_blank\">\n                    <dy-img [imgStyle]=\"'width: 100%; height: auto;'\" [sizeRatio]=\"100/this.slidesPerView()\" [image]=\"picture\"\n                            [alt]=\"picture.alt ?? 'swiper image'\" [transitionName]=\"$first ? transition() : 'none'\"\n                            [(height)]=\"sizes().get(picture.originalUrl)!.height\"\n                            [(width)]=\"sizes().get(picture.originalUrl)!.width\"></dy-img>\n                  </a>\n                </div>\n              </div>\n            </div>\n          }\n        </div>\n        <div class=\"swiper-pagination\"></div>\n\n        <div class=\"swiper-button-prev\"></div>\n        <div class=\"swiper-button-next\"></div>\n      </div>\n    </div>\n    <div class=\"text-center dy-arrow\">\n      <i [class]=\"'swiper-button-next-dy' + id()\"><span\n        class=\"material-symbols-outlined\">chevron_right</span></i>\n    </div>\n  </div>\n  <div *ngIf=\"withGallery()\" class=\"row\">\n    <div class=\"hidden md:block col-md-2 position-relative\">\n      <div id=\"image-list-detail\">\n        <div class=\"ab\">\n          <ng-container *ngFor=\"let picture of pictures(); let i = index\">\n            <img (click)=\"goto(i)\"\n                 [class.ab_active]=\"i == active_id\"\n                 [src]=\"picture.thumbnailUrl\"\n                 [style.height]=\"getThumbnailHeight(pictures()) + '%'\"\n                 [style.width]=\"getThumbnailHeight(pictures()) + '%'\"\n                 alt=\"thumbnail\"\n                 class=\"cd\"\n            />\n          </ng-container>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n", styles: [".swiper{width:100%;height:auto}img{display:block;margin:auto;max-width:100%!important}#image-list-detail{height:100%;position:absolute;text-align:left;margin-left:0;margin-right:auto;display:flex;justify-content:flex-end}.ab{display:inline-block;height:100%;margin-left:auto!important;margin-right:0!important}.cd{display:block;padding:3px;margin-left:0;margin-right:auto;object-fit:cover;aspect-ratio:297/210}@media (min-width: 576px){.cd{width:auto!important}}@media (max-width: 576px){img{width:100%!important;margin:unset!important}.swiper{width:100%!important}.cd{display:inline;height:auto!important}#image-list-detail{height:fit-content!important}}.ab_active{padding:2px;border:rgb(215,224,243) solid 2px}::ng-deep .pswp__button{width:5rem!important;height:5.5rem!important}::ng-deep .pswp__icn{width:4rem!important;height:4rem!important}.img-link{display:block;width:fit-content;margin:auto}.material-symbols-outlined{font-size:4rem}@media (min-width: 768px){.dy-arrow{width:4%;color:var(--dy-primary)}.dy-main{width:92%}}@media (max-width: 768px){.dy-arrow{display:none;width:0;color:var(--dy-primary)}.dy-main{width:100%}}.swiper-button-next,.swiper-button-prev{display:block}@media (min-width: 768px){.swiper-button-next,.swiper-button-prev{display:none}}\n"] }]
        }], ctorParameters: () => [{ type: Object, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHktc3dpcGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2N1c3RvbS1kaXNwbGF5L3NyYy9saWIvY29tcG9uZW50cy9pbWFnZXMvZHktc3dpcGVyL2R5LXN3aXBlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9jdXN0b20tZGlzcGxheS9zcmMvbGliL2NvbXBvbmVudHMvaW1hZ2VzL2R5LXN3aXBlci9keS1zd2lwZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxRQUFRLEVBQ1IsTUFBTSxFQUNOLEtBQUssRUFJTCxXQUFXLEVBQ1gsTUFBTSxFQUdQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDakUsT0FBTyxrQkFBa0IsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUM7QUFDcEMsa0RBQWtEO0FBQ2xELGFBQWE7QUFDYixPQUFPLE1BQU0sTUFBTSxlQUFlLENBQUM7QUFFbkMsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0sNkNBQTZDLENBQUM7QUFDbEYsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLGdDQUFnQyxDQUFDOztBQWM5RCxNQUFNLE9BQU8saUJBQWlCO0lBcUI1QixZQUF5QyxXQUFtQjtRQUFuQixnQkFBVyxHQUFYLFdBQVcsQ0FBUTtRQXBCNUQsY0FBUyxHQUFXLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLGFBQVEsR0FBZ0MsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3pELE9BQUUsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDcEIsY0FBUyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtR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cUJBQ2Y7OzBCQXlCWSxNQUFNOzJCQUFDLFdBQVciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIGNvbXB1dGVkLFxuICBJbmplY3QsXG4gIGlucHV0LFxuICBJbnB1dFNpZ25hbCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIFBMQVRGT1JNX0lELFxuICBzaWduYWwsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFdyaXRhYmxlU2lnbmFsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtpc1BsYXRmb3JtQnJvd3NlciwgTmdGb3JPZiwgTmdJZn0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vblwiO1xuaW1wb3J0IFBob3RvU3dpcGVMaWdodGJveCBmcm9tIFwicGhvdG9zd2lwZS9saWdodGJveFwiO1xuaW1wb3J0IFBob3RvU3dpcGUgZnJvbSBcInBob3Rvc3dpcGVcIjtcbi8vIGltcG9ydCBTd2lwZXIgYnVuZGxlIHdpdGggYWxsIG1vZHVsZXMgaW5zdGFsbGVkXG4vLyBAdHMtaWdub3JlXG5pbXBvcnQgU3dpcGVyIGZyb20gJ3N3aXBlci9idW5kbGUnO1xuaW1wb3J0IHtEeUltYWdlfSBmcm9tIFwiLi4vLi4vLi4vbW9kZWwvaW1hZ2VzL2R5LWltYWdlXCI7XG5pbXBvcnQge0R5VHJhbnNpdGlvbkRpcmVjdGl2ZX0gZnJvbSBcIi4uLy4uLy4uL2RpcmVjdGl2ZXMvZHktdHJhbnNpdGlvbi5kaXJlY3RpdmVcIjtcbmltcG9ydCB7RHlJbWdDb21wb25lbnR9IGZyb20gXCIuLi90YWcvZHktaW1nL2R5LWltZy5jb21wb25lbnRcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYXBwLWR5LXN3aXBlcicsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtcbiAgICBOZ0Zvck9mLFxuICAgIE5nSWYsXG4gICAgRHlUcmFuc2l0aW9uRGlyZWN0aXZlLFxuICAgIER5SW1nQ29tcG9uZW50XG4gIF0sXG4gIHRlbXBsYXRlVXJsOiAnLi9keS1zd2lwZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybDogJy4vZHktc3dpcGVyLmNvbXBvbmVudC5zY3NzJ1xufSlcbmV4cG9ydCBjbGFzcyBEeVN3aXBlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzIHtcbiAgYWN0aXZlX2lkOiBudW1iZXIgPSAtMTtcbiAgcGljdHVyZXM6IElucHV0U2lnbmFsPEFycmF5PER5SW1hZ2U+PiA9IGlucHV0LnJlcXVpcmVkKCk7XG4gIGlkID0gaW5wdXQoJ3N3aXBlcicpXG4gIG5vR2FsbGVyeSA9IGlucHV0KGZhbHNlKVxuICB3aXRoR2FsbGVyeSA9IGNvbXB1dGVkKCgpID0+IHRoaXMubm9HYWxsZXJ5KCkgPyBmYWxzZSA6IHRoaXMucGljdHVyZXMoKSA/IHRoaXMucGljdHVyZXMoKS5sZW5ndGggPiAxIDogZmFsc2UpO1xuICBzbGlkZXNQZXJWaWV3ID0gaW5wdXQoMSlcbiAgc3BhY2VCZXR3ZWVuID0gaW5wdXQoMClcbiAgdGhlbWVDb2xvciA9IGlucHV0KCcjNjQ2NDY0JylcbiAgbWFyZ2luX3g6IElucHV0U2lnbmFsPG51bWJlcj4gPSBpbnB1dCg1KTtcbiAgdHJhbnNpdGlvbjogSW5wdXRTaWduYWw8c3RyaW5nPiA9IGlucHV0KCdub25lJyk7XG4gIHNpemVzID0gY29tcHV0ZWQoKCkgPT4ge1xuICAgIGNvbnN0IG1hcCA9IG5ldyBNYXA8c3RyaW5nLCB7IGhlaWdodDogV3JpdGFibGVTaWduYWw8bnVtYmVyPiwgd2lkdGg6IFdyaXRhYmxlU2lnbmFsPG51bWJlcj4gfT4oKTtcbiAgICB0aGlzLnBpY3R1cmVzKCkuZm9yRWFjaChwaWMgPT4ge1xuICAgICAgbWFwLnNldChwaWMub3JpZ2luYWxVcmwsIHtoZWlnaHQ6IHNpZ25hbCgwKSwgd2lkdGg6IHNpZ25hbCgwKX0pO1xuICAgIH0pO1xuICAgIHJldHVybiBtYXBcbiAgfSlcbiAgcHJpdmF0ZSBzd2lwZXI/OiBTd2lwZXI7XG4gIHByaXZhdGUgbGlnaHRib3g/OiBQaG90b1N3aXBlTGlnaHRib3g7XG5cbiAgY29uc3RydWN0b3IoQEluamVjdChQTEFURk9STV9JRCkgcHJpdmF0ZSBfcGxhdGZvcm1JZDogT2JqZWN0KSB7XG4gIH1cblxuXG4gIGdvdG8oaWQ6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuc3dpcGVyIS5zbGlkZVRvTG9vcChpZClcbiAgfVxuXG5cbiAgZ2V0VGh1bWJuYWlsSGVpZ2h0KHBpY3R1cmVzOiBBcnJheTxEeUltYWdlPikge1xuICAgIHJldHVybiBNYXRoLm1pbigxMDAgLyBwaWN0dXJlcy5sZW5ndGgsIDMzKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMubGlnaHRib3g/LmRlc3Ryb3koKVxuICAgIHRoaXMuc3dpcGVyPy5kZXN0cm95KClcbiAgfVxuXG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzWydwaWN0dXJlcyddICYmIGNoYW5nZXNbJ3BpY3R1cmVzJ10ucHJldmlvdXNWYWx1ZSkge1xuICAgICAgLy8gQ2hlY2sgaWYgaW5wdXRDaGFuZ2VUcmlnZ2VyIGhhcyBjaGFuZ2VkXG4gICAgICAvLyBZb3UgY2FuIGFkZCBtb3JlIGNvbmRpdGlvbnMgYmFzZWQgb24geW91ciByZXF1aXJlbWVudHNcbiAgICAgIHRoaXMubmdPbkRlc3Ryb3koKVxuICAgICAgdGhpcy5uZ0FmdGVyVmlld0luaXQoKVxuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5fcGxhdGZvcm1JZCkpIHtcbiAgICAgIHRoaXMuc3dpcGVyID0gbmV3IFN3aXBlcihgIyR7dGhpcy5pZCgpfWAsIHtcbiAgICAgICAgLy8gT3B0aW9uYWwgcGFyYW1ldGVyc1xuICAgICAgICBsb29wOiB0cnVlLFxuICAgICAgICBrZXlib2FyZDoge1xuICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgb25seUluVmlld3BvcnQ6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICAvLyBJZiB3ZSBuZWVkIHBhZ2luYXRpb25cbiAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgIGVsOiAnLnN3aXBlci1wYWdpbmF0aW9uJyxcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBOYXZpZ2F0aW9uIGFycm93c1xuICAgICAgICBuYXZpZ2F0aW9uOiB7XG4gICAgICAgICAgbmV4dEVsOiAnLnN3aXBlci1idXR0b24tbmV4dCcsXG4gICAgICAgICAgcHJldkVsOiAnLnN3aXBlci1idXR0b24tcHJldicsXG4gICAgICAgIH0sXG4gICAgICAgIC8vIFJlc3BvbnNpdmUgYnJlYWtwb2ludHNcbiAgICAgICAgYnJlYWtwb2ludHM6IHtcbiAgICAgICAgICAvLyB3aGVuIHdpbmRvdyB3aWR0aCBpcyA+PSA2NDBweFxuICAgICAgICAgIDY0MDoge1xuICAgICAgICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICAgICAgICBuZXh0RWw6ICcuc3dpcGVyLWJ1dHRvbi1uZXh0LWR5JyArIHRoaXMuaWQoKSxcbiAgICAgICAgICAgICAgcHJldkVsOiAnLnN3aXBlci1idXR0b24tcHJldi1keScgKyB0aGlzLmlkKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3BhY2VCZXR3ZWVuOiB0aGlzLnNwYWNlQmV0d2VlbigpLFxuICAgICAgICAgICAgc2xpZGVzUGVyVmlldzogdGhpcy5zbGlkZXNQZXJWaWV3KCksIC8vIG9yIDQgZGVwZW5kaW5nIG9uIHlvdXIgcHJlZmVyZW5jZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8geW91IGNhbiBhZGQgbW9yZSBicmVha3BvaW50cyBpZiBuZWVkZWRcbiAgICAgICAgfSxcbiAgICAgICAgLy8gQW5kIGlmIHdlIG5lZWQgc2Nyb2xsYmFyXG4gICAgICAgIHNjcm9sbGJhcjoge1xuICAgICAgICAgIGhpZGU6IHRydWUsXG4gICAgICAgIH0sXG5cbiAgICAgICAgb246IHtcbiAgICAgICAgICBzbGlkZUNoYW5nZVRyYW5zaXRpb25FbmQ6IChzd2lwZXI6IFN3aXBlcikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coc3dpcGVyLnJlYWxJbmRleClcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQWN0aXZlSW5kZXgoc3dpcGVyLnJlYWxJbmRleClcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5saWdodGJveCA9IG5ldyBQaG90b1N3aXBlTGlnaHRib3goe1xuICAgICAgICAgIGdhbGxlcnk6IGAjJHt0aGlzLmlkKCl9YCxcbiAgICAgICAgICBjaGlsZHJlbjogJ2EnLFxuICAgICAgICAgIHBzd3BNb2R1bGU6IFBob3RvU3dpcGUsXG4gICAgICAgICAgem9vbTogdHJ1ZVxuICAgICAgICB9KVxuICAgICAgICB0aGlzLmxpZ2h0Ym94LmluaXQoKVxuICAgICAgfSwgMTAwKTtcbiAgICB9XG4gIH1cblxuICBjaGFuZ2VBY3RpdmVJbmRleChpbmRleDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5hY3RpdmVfaWQgPSBpbmRleDtcbiAgfVxuXG59XG4iLCI8ZGl2IFtjbGFzcy5jb2wtbWQtMTBdPVwid2l0aEdhbGxlcnkoKVwiIFtjbGFzcy5jb2wtbWQtMTJdPVwiIXdpdGhHYWxsZXJ5KClcIiBbc3R5bGUuLS1zd2lwZXItdGhlbWUtY29sb3JdPVwidGhlbWVDb2xvcigpXCI+XG4gIDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyO1wiPlxuICAgIDxkaXYgY2xhc3M9XCJkeS1hcnJvdyB0ZXh0LWNlbnRlclwiPlxuICAgICAgPGkgW2NsYXNzXT1cIidzd2lwZXItYnV0dG9uLXByZXYtZHknICsgaWQoKVwiPjxzcGFuXG4gICAgICAgIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZFwiPmNoZXZyb25fbGVmdDwvc3Bhbj48L2k+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImR5LW1haW5cIj5cbiAgICAgIDxkaXYgW2lkXT1cImlkKClcIiBjbGFzcz1cInN3aXBlclwiPlxuICAgICAgICA8IS0tIEFkZGl0aW9uYWwgcmVxdWlyZWQgd3JhcHBlciAtLT5cbiAgICAgICAgPGRpdiBjbGFzcz1cInN3aXBlci13cmFwcGVyXCI+XG4gICAgICAgICAgQGZvciAocGljdHVyZSBvZiBwaWN0dXJlcygpOyB0cmFjayBwaWN0dXJlLm9yaWdpbmFsVXJsKSB7XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzd2lwZXItc2xpZGVcIiBpZD1cInt7IHBpY3R1cmUub3JpZ2luYWxVcmwgfX1cIj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInBpY3N1bS1pbWctd3JhcHBlclwiXG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICBbc3R5bGUucGFkZGluZy1sZWZ0XT1cIm1hcmdpbl94KCkgKyAnJSdcIlxuICAgICAgICAgICAgICAgICAgW3N0eWxlLnBhZGRpbmctcmlnaHRdPVwibWFyZ2luX3goKSArICclJ1wiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgPGEgW2hyZWZdPVwicGljdHVyZS5vcmlnaW5hbFVybFwiXG4gICAgICAgICAgICAgICAgICAgICBbYXR0ci5kYXRhLXBzd3Atd2lkdGhdPVwic2l6ZXMoKS5nZXQocGljdHVyZS5vcmlnaW5hbFVybCkhLndpZHRoKCkqdGhpcy5zbGlkZXNQZXJWaWV3KClcIlxuICAgICAgICAgICAgICAgICAgICAgW2F0dHIuZGF0YS1wc3dwLWhlaWdodF09XCJzaXplcygpLmdldChwaWN0dXJlLm9yaWdpbmFsVXJsKSEuaGVpZ2h0KCkqdGhpcy5zbGlkZXNQZXJWaWV3KClcIlxuICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJpbWctbGlua1wiIHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICAgICAgICAgICAgICA8ZHktaW1nIFtpbWdTdHlsZV09XCInd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bzsnXCIgW3NpemVSYXRpb109XCIxMDAvdGhpcy5zbGlkZXNQZXJWaWV3KClcIiBbaW1hZ2VdPVwicGljdHVyZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW2FsdF09XCJwaWN0dXJlLmFsdCA/PyAnc3dpcGVyIGltYWdlJ1wiIFt0cmFuc2l0aW9uTmFtZV09XCIkZmlyc3QgPyB0cmFuc2l0aW9uKCkgOiAnbm9uZSdcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsoaGVpZ2h0KV09XCJzaXplcygpLmdldChwaWN0dXJlLm9yaWdpbmFsVXJsKSEuaGVpZ2h0XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbKHdpZHRoKV09XCJzaXplcygpLmdldChwaWN0dXJlLm9yaWdpbmFsVXJsKSEud2lkdGhcIj48L2R5LWltZz5cbiAgICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICB9XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3dpcGVyLXBhZ2luYXRpb25cIj48L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwic3dpcGVyLWJ1dHRvbi1wcmV2XCI+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzd2lwZXItYnV0dG9uLW5leHRcIj48L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJ0ZXh0LWNlbnRlciBkeS1hcnJvd1wiPlxuICAgICAgPGkgW2NsYXNzXT1cIidzd2lwZXItYnV0dG9uLW5leHQtZHknICsgaWQoKVwiPjxzcGFuXG4gICAgICAgIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZFwiPmNoZXZyb25fcmlnaHQ8L3NwYW4+PC9pPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbiAgPGRpdiAqbmdJZj1cIndpdGhHYWxsZXJ5KClcIiBjbGFzcz1cInJvd1wiPlxuICAgIDxkaXYgY2xhc3M9XCJoaWRkZW4gbWQ6YmxvY2sgY29sLW1kLTIgcG9zaXRpb24tcmVsYXRpdmVcIj5cbiAgICAgIDxkaXYgaWQ9XCJpbWFnZS1saXN0LWRldGFpbFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYWJcIj5cbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBwaWN0dXJlIG9mIHBpY3R1cmVzKCk7IGxldCBpID0gaW5kZXhcIj5cbiAgICAgICAgICAgIDxpbWcgKGNsaWNrKT1cImdvdG8oaSlcIlxuICAgICAgICAgICAgICAgICBbY2xhc3MuYWJfYWN0aXZlXT1cImkgPT0gYWN0aXZlX2lkXCJcbiAgICAgICAgICAgICAgICAgW3NyY109XCJwaWN0dXJlLnRodW1ibmFpbFVybFwiXG4gICAgICAgICAgICAgICAgIFtzdHlsZS5oZWlnaHRdPVwiZ2V0VGh1bWJuYWlsSGVpZ2h0KHBpY3R1cmVzKCkpICsgJyUnXCJcbiAgICAgICAgICAgICAgICAgW3N0eWxlLndpZHRoXT1cImdldFRodW1ibmFpbEhlaWdodChwaWN0dXJlcygpKSArICclJ1wiXG4gICAgICAgICAgICAgICAgIGFsdD1cInRodW1ibmFpbFwiXG4gICAgICAgICAgICAgICAgIGNsYXNzPVwiY2RcIlxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==